WS=WS||{};WS.Stats={};var statsFieldWidth=630;WS.Stats.Info=function(config){var id,$view,view,model,teamIds,lastViewOptions,currentModel,monitorChanges;init(config);this.load=function(data){loadTeamIds(data);var newModel={home:model.instanceType(data.home),away:model.instanceType(data.away)};if(lastViewOptions.flagsOnLeft){renderFlagsOnLeft(newModel);}else{render(newModel);}if(monitorChanges){currentModel=newModel;}};function loadTeamIds(data){teamIds.home=data.home.teamId;teamIds.away=data.away.teamId;}this.id=function(){return id;};this.updateTitle=function(title){$("#"+id+" .title").html(title);};function init(config){view=config.view;$view=$("#"+view.renderTo);model=config.model;id=view.renderTo;teamIds={};view.labelWidth=view.labelWidth||120;view.statValueWidth=60;view.containerWidth=view.containerWidth||644;view.statsWidth=view.width-view.labelWidth-(2*view.statValueWidth);view.hideBars=view.hideBars;monitorChanges=model.monitorChanges;lastViewOptions=getDefaultViewOptions();}function getDefaultViewOptions(){return jQuery.extend(true,{},view);}function displayPlayed(homeData,awayData){return homeData.played&&awayData.played;}function resetLastViewOptions(){lastViewOptions=getDefaultViewOptions();}function updateLastViewOptionsByLabelGroup(labelGroup,label){if(labelGroup){if(null!=labelGroup.labelWidth){lastViewOptions.labelWidth=labelGroup.labelWidth;}if(null!=labelGroup.statValueWidth){lastViewOptions.statValueWidth=labelGroup.statValueWidth;}if(!label.displayValue){lastViewOptions.labelWidth=0;}lastViewOptions.statsWidth=lastViewOptions.width-lastViewOptions.labelWidth-(2*lastViewOptions.statValueWidth);}}function showBars(labelGroup){return !view.hideBars&&!(labelGroup&&labelGroup.hideBars);}function renderFlagsOnLeft(data){var t=[];if(!data){return;}if(!data.home||!data.away){renderEmpty();return;}t.push('<div class="three-cols">');t.push('<div class="left" style="width: '+((view.containerWidth-lastViewOptions.width)/2)+'px;">');t.push("<ul>");t.push("<li>");t.push(WS.TeamEmblemUrl(teamIds.home));t.push("</li>");t.push('<li class="played">Played: '+data.home.played+"</li>");t.push("</ul>");t.push("</div>");t.push('<div class="centre" style="width: '+lastViewOptions.width+'px">');t.push(renderStats(data.home,data.away));t.push("</div>");t.push('<div class="right" style="width: '+((view.containerWidth-lastViewOptions.width)/2)+'px;">');t.push("<ul>");t.push("<li>");t.push(WS.TeamEmblemUrl(teamIds.away));t.push("</li>");t.push('<li class="played">Played: '+data.away.played+"</li>");t.push("</ul>");t.push("</div>");t.push("</div>");$view.html(t.join(""));}function render(data){var t=[];if(!data){return;}if(!data.home||!data.away){renderEmpty();return;}if(displayPlayed(data.home,data.away)){t.push('<div class="matches-played">');t.push('<span class="home-played ta-left">');t.push(WS.TeamEmblemUrl(teamIds.home));t.push('<span class="played-text">Played: '+data.home.played+"</span>");t.push("</span>");t.push('<span class="away-played ta-right">');t.push('<span class="played-text">Played: '+data.away.played+"</span>");t.push(WS.TeamEmblemUrl(teamIds.away));t.push("</span>");t.push("</div>");}t.push(renderStats(data.home,data.away));$("#"+view.renderTo).html(t.join(""));}function renderStats(homeData,awayData){var t=[];var alt=false;for(var i=0;i<model.labels.length;i++){var label=[];var labelGroup=getLabelGroup(i);resetLastViewOptions();updateLastViewOptionsByLabelGroup(labelGroup,model.labels[i]);if(labelGroup&&labelGroup.alternateRowType){alt=1==labelGroup.alternateRowType?0==i%2:1==i%2;}var homeDisplayValue=getStatDisplayValue(homeData.data[i],model.labels[i].type,awayData.data[i]);var awayDisplayValue=getStatDisplayValue(awayData.data[i],model.labels[i].type,homeData.data[i]);if(model.labels[i].displayTemplate){label.push(model.labels[i].displayTemplate(homeData.data[i],awayData.data[i]));}else{label.push('<div class="stat {0}">'.format(alt?"alt":""));if(showBars(labelGroup)){label.push('<span  style="width:'+view.width+'px;">');label.push('<span class="stat-bar-wrapper home '+(model.labels[i].clazz?model.labels[i].clazz:"")+'" style="width:'+(lastViewOptions.statsWidth/2)+'px;">');label.push('<span class="stat-bar rc-l" style="width: '+getWidth(homeData.data,awayData.data,i,labelGroup)+'px;"></span>');label.push("</span>");}label.push('<span style="width: '+lastViewOptions.statValueWidth+'px" class="stat-value">'+homeDisplayValue+"</span>");if(model.labels[i].displayValue){label.push('<span class="stat-label" style="width: '+lastViewOptions.labelWidth+'px;">'+model.labels[i].displayValue+"</span>");}label.push('<span style="width: '+lastViewOptions.statValueWidth+'px" class="stat-value">'+awayDisplayValue+"</span>");if(showBars(labelGroup)){label.push('<span class="stat-bar-wrapper away '+(model.labels[i].clazz?model.labels[i].clazz:"")+'" style="width:'+(lastViewOptions.statsWidth/2)+'px;">');label.push('<span class="stat-bar rc-r" style="width: '+getWidth(awayData.data,homeData.data,i,labelGroup)+'px;"></span>');label.push("</span>");label.push("</span>");}label.push("</div>");}if(labelGroup){if(i==labelGroup.start){t.push('<div class="stat-group '+(labelGroup.clazz||"")+'" style="'+(labelGroup.style||"")+'">');if(labelGroup.title){t.push('<div class="title">'+labelGroup.title+"</div>");}}t.push(label.join(""));if(i==labelGroup.end){t.push("</div>");}}else{t.push(label.join(""));}}return t.join("");}function getLabelGroup(index){if(!model.labelGroups){return;}for(var i=0;i<model.labelGroups.length;i++){var labelGroup=model.labelGroups[i];if(labelGroup.start<=index&&index<=labelGroup.end){return labelGroup;}}}function renderEmpty(){$("#"+view.renderTo).html('<div class="note empty">N/A..</div>');}function getStatDisplayValue(value,type,otherValue,oldValue){var isGreater=NG.numberIsGreaterThan(value,otherValue);var value=parseFloat(NG.roundNumber(value,1));if("percentage"==type){var thisPercentage=NG.roundNumber(value);var otherPercentage=NG.roundNumber(otherValue);if(100<thisPercentage+otherPercentage){if(thisPercentage<otherPercentage){thisPercentage-=1;}}value=thisPercentage+(("percentage")==type?"%":"");}return'<span class="{1} {2}">{0}</span>'.format(value,monitorChanges&&currentModel?statChanged(value,oldValue)?"pulsable":"":"pulsable",isGreater?"greater":"");}function getWidth(data,opponentData,index,labelGroup){var value=data[index],opponentValue=opponentData[index];var values=getValuesToCalculateWidth(data,opponentData,index,labelGroup);var width=getExpandedWidth(value,values,index,labelGroup);return width;}function getExpandedWidth(ownValue,values,index){var canExpand=true,sum=model.labels[index].maxValue?model.labels[index].maxValue:values.sum(),expansion=1;if(0==sum){return 0;}while(canExpand){for(var i=0;i<values.length;i++){var width=parseInt((values[i]*lastViewOptions.statsWidth/2)/(sum));if(lastViewOptions.statsWidth/2<=(width*1.25)){canExpand=false;}else{values[i]*=1.25;}}if(canExpand){expansion*=1.25;}}return parseInt((ownValue*expansion*lastViewOptions.statsWidth/2)/(sum));}function getValuesToCalculateWidth(data,opponentData,index,labelGroup){var values=[];if(labelGroup&&!labelGroup.noRelativity){for(var i=labelGroup.start;i<=labelGroup.end;i++){values.push(data[i]);values.push(opponentData[i]);}}else{values.push(data[index]);values.push(opponentData[index]);}return values;}function getSumOfValues(data,opponentData,start,end){var sum=0;for(var i=start;i<=end;i++){sum+=data[i];sum+=opponentData[i];}return sum;}};WS.Legends=function(config){var id,view,model;init(config);function init(config){id=config.id;view=config.view;model=config.model;render();}function render(){var t=[];t.push('<ul class="legends">');for(var i=0;i<model.length;i++){t.push('<li> <span class="box legend" style="background-color: '+model[i].color+'">&nbsp;</span>'+model[i].displayName+"</li>");}t.push("</ul>");$("#"+view.renderTo).html(t.join(""));}};WS.Stats.PieChart=function(config){var id,chart,legends,view,model,currentTotal,currentData;init(config);this.load=function(data,selected){clearData();currentData=data;addData(prepareData(currentData,selected));};this.id=function(){return id;};this.showLoading=function(){chart.showLoading();};this.hideLoading=function(){chart.hideLoading();};this.updateFilter=function(index){this.load(currentData,index);};function init(config){model=config.model||{};view=config.view||{};id=view.renderTo;chart=getChart();}function prepareData(data,selected){var records=data;if(!records){$("#"+id).triggerHandler("empty-data");return null;}var series={type:"pie",data:[]};currentTotal=records.sum();function isMax(records,index){return records.max()==records[index];}for(var i=0;i<model.categories.length;i++){var sliced=selected?i==selected:isMax(records,model.categories[i].id);series.data.push({name:model.categories[i].displayName,color:model.categories[i].color,sliced:sliced,selected:sliced,y:records[model.categories[i].id]});}return series;}function addData(data){if(!data){return;}chart.addSeries(data);}function clearData(){if(0!=chart.series.length){for(var i=0;i<chart.series.length;i++){chart.series[i].remove();}}}function getCategoryIdentifiers(category){var identifiers={};var index;for(var i=0;i<model.categories.length;i++){if(model.categories[i].displayName==category){identifiers={clicked:{id:model.categories[i].id}};index=i;}}if(model.identifiers){identifiers.index=model.identifiers.index;identifiers.value=model.identifiers.value[index];}return identifiers;}function getChart(){return new Highcharts.Chart({chart:{renderTo:view.renderTo,backgroundColor:$.extend({},{linearGradient:[0,0,500,500],stops:[[0,"#fff"],[1,"#fff"]]},view.backgroundColor),margin:[50,10,30,20],width:view.width?view.width:330,height:view.height?view.height:260},title:{text:view.title||"",style:$.extend({},{font:"18px Arial,Helvetica,sans-serif",color:"#222"},view.titleStyle)},plotArea:{shadow:null,borderWidth:null,backgroundColor:null},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b>: "+(currentTotal&&0!=currentTotal?parseInt(100*this.y/currentTotal):0)+("value"==model.type?"":"%");}},plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",size:view.size?view.size:150,center:view.center?view.center:[140,90],dataLabels:{enabled:view.dataLabels?view.dataLabels.enabled:false,formatter:(view.dataLabels&&view.dataLabels.formatter)?view.dataLabels.formatter:function(){if((currentTotal&&0!=currentTotal?parseInt(100*this.y/currentTotal):0)>30){return this.point.name;}},style:{font:(view.dataLabels&&view.dataLabels.style&&view.dataLabels.style.font)?view.dataLabels.style.font:"12px Arial,Helvetica,sans-serif",color:(view.dataLabels&&view.dataLabels.style&&view.dataLabels.style.color)?view.dataLabels.style.color:"#222"}},showInLegend:view.showInLegend},series:{cursor:"pointer",events:{click:function(event){$("#"+id).triggerHandler("clicked",[getCategoryIdentifiers(event.point.name)]);}}}},credits:{enabled:false},legend:{enabled:view.showLegends?true:false,style:{left:"auto",bottom:"0px"}},loading:{labelStyle:{top:"45%",font:"2em Verdana,Arial,Helvetica,sans-serif",position:"relative"},hideDuration:500,showDuration:500},series:[]});}};WS.Stats.BarChart=function(config){var id,chart,view,model;init(config);this.load=function(data){clearData();model.home.data=prepareData(data.home);model.away.data=prepareData(data.away);addData(model.home);addData(model.away);$("#"+id).triggerHandler("model-updated");};function addData(data){chart.addSeries(data);}this.id=function(){return id;};this.showLoading=function(){chart.showLoading();};this.hideLoading=function(){chart.hideLoading();};function prepareData(records){records=model.instanceType(records);var data=[];for(var i=0;i<records.length;i++){data.push(getValue(records,i));}return data;}function getValue(records,index){if("percentage"==model.type){return parseInt(100*records[index]/records.sum());}return records[index];}function clearData(){chart.series[0].remove();chart.series[0].remove();}function init(config){model=config.model||{};view=config.view||{};id=view.renderTo;chart=getChart(view,model);}function getCategoryIdentifiers(category){for(var i=0;i<model.categories.displayNames.length;i++){if(model.categories.displayNames[i]==category){return{clicked:{index:model.categories.identifiers.index,value:model.categories.identifiers.value[i]}};}}}function getChart(view,model){return new Highcharts.Chart({chart:{renderTo:view.renderTo,backgroundColor:{linearGradient:[0,0,500,500],stops:[[0,"#333333"],[1,"#575757"]]},width:view.width?view.width:660,height:view.height?view.height:300,defaultSeriesType:"column",events:{click:function(){$("#"+id).triggerHandler("clicked");}}},title:{text:view.title,style:{fontFamily:"Arial,Helvetica,sans-serif",color:"#CCC",fontWeight:"bold"}},credits:{enabled:false},legend:{itemStyle:{color:"#ccc",fontFamily:"Arial,Helvetica,sans-serif"}},xAxis:{categories:model.categories.displayNames,labels:{style:{color:"#CCC",fontFamily:"Arial,Helvetica,sans-serif"}}},yAxis:{min:model.min,title:{text:view.yAxisTitle,style:{color:"#CCC",fontFamily:"Arial,Helvetica,sans-serif",fontSize:"1.2em"}},labels:{style:{color:"#CCC",fontFamily:"Arial,Helvetica,sans-serif"}}},subtitle:view.subtitle,tooltip:{formatter:model.tooltip?model.tooltip:function(){return""+this.x+": "+this.y+("percentage"==model.type?"%":"");}},plotOptions:{series:{pointWidth:view.columnWidth?view.columnWidth:20,pointPadding:0,cursor:view.cursor?view.cursor:"pointer"},column:{borderWidth:0,point:{events:{click:function(){$("#"+id).triggerHandler("clicked",[getCategoryIdentifiers(this.category)]);}}}}},loading:{labelStyle:{top:"45%",font:"2em Arial,Helvetica,sans-serif",position:"relative"},hideDuration:500,showDuration:500},series:[model.home,model.away]});}};function H2HAggressionModel(data){var records=[0,0,0,0];if(!data.value||0==data.value.length){return records;}var values=data.value[0];AggresionModel(records,values);return records;}function AggresionModel(records,values){var groupedReasons=[[1],[3,4,5,7,8],[9],[2,6,0]];for(var i=0;i<groupedReasons.length;i++){for(var j=0;j<values.length;j++){if(-1!=$.inArray(values[j][0],groupedReasons[i])){records[i]+=values[j][1];}}}}function LiveAggressionModel(data){var records=[0,0,0,0];if(!data.value||0==data.value.length){return records;}var values=data.value[0][0][0];if(!values){return records;}AggresionModel(records,values);return records;}function H2HAggressionInfoModel(data){var record={data:[0,0,0,0]};var fouls=0,red=0,yellow=0;var value=data.value[0];if(0!=value.length){var infos=value[value.length-1][0];for(var i=0;i<infos.length;i++){if("fk_foul_lost"==infos[i][0]){fouls+=infos[i][1][0];}if("total_red_card"==infos[i][0]){red+=infos[i][1][0];}if("total_yel_card"==infos[i][0]){yellow+=infos[i][1][0];}}}record.data[0]=parseFloat((red/data.played).toFixed(2));record.data[1]=parseFloat((yellow/data.played).toFixed(2));record.data[2]=parseFloat((100*(yellow+red)/fouls).toFixed(2));record.data[3]=parseFloat((fouls/data.played).toFixed(2));return record;}function LiveAggressionInfoModel(data){var record={data:[0,0,0,0]};var fouls=0,red=0,yellow=0;var value=data.value[0];if(0!=value.length){var infos=value[value.length-1][0];for(var i=0;i<infos.length;i++){if("fk_foul_lost"==infos[i][0]){fouls+=infos[i][1][0];}if("fk_foul_lost"==infos[i][2]){fouls+=infos[i][3][0];}if("total_red_card"==infos[i][2]){red+=infos[i][3][0];}if("total_red_card"==infos[i][0]){red+=infos[i][1][0];}if("total_yel_card"==infos[i][0]){yellow+=infos[i][1][0];}if("total_yel_card"==infos[i][2]){yellow+=infos[i][3][0];}}}record.data[0]=red;record.data[1]=yellow;record.data[2]=parseFloat((100*(yellow+red)/fouls).toFixed(2));record.data[3]=fouls;return record;}function H2HGoalTypesInfoModel(data){function getValue(value,resultFilter,typeFilter){if(resultFilter==value[0]){if(typeFilter){if(0!=typeFilter.value.length){for(var k=0;k<typeFilter.value.length;k++){if(typeFilter.value[k]==value[typeFilter.index]){return value[3][0];}}}}else{return value[3][0];}}return 0;}var records={data:[0,0,0]};if(!data.value||0==data.value.length){return records;}var values=data.value[0];var goals=0,misses=0,shots=0;for(var i=0;i<values.length;i++){misses+=getValue(values[i],"miss",data.contentFilter.clicked);goals+=getValue(values[i],"goal",data.contentFilter.clicked);}shots=goals+misses;records.data[0]=parseFloat((shots/data.played).toFixed(2));records.data[1]=parseFloat((goals/data.played).toFixed(2));records.data[2]=0==shots?0:parseInt(100*goals/shots);return records;}function LiveGoalTypesInfoModel(data){function getValue(value,resultFilter,typeFilter){if(resultFilter==value[0]){if(typeFilter){if(0!=typeFilter.value.length){for(var k=0;k<typeFilter.value.length;k++){if(typeFilter.value[k]==value[typeFilter.index]){return value[3][0];}}}}else{return value[3][0];}}return 0;}var records={played:data.played,data:[0,0,0]};if(!data.value||0==data.value.length){return records;}var values=data.value[2];var goals=0,misses=0,shots=0;for(var i=0;i<values.length;i++){misses+=getValue(values[i],"miss",data.contentFilter.clicked);goals+=getValue(values[i],"goal",data.contentFilter.clicked);}shots=goals+misses;records.data[0]=shots;records.data[1]=goals;records.data[2]=0==shots?0:parseInt(100*goals/shots);return records;}function H2HPassTypesInfoModel(data){function getValue(value,passTypeFilter){if(passTypeFilter){for(var i=0;i<passTypeFilter.value.length;i++){if(passTypeFilter.value[i]==value[passTypeFilter.index]){return value[2][0];}}return 0;}return value[2][0];}if(!data.value||0==data.value.length){return{played:0,data:[0,0]};}var averagePassStreak=parseFloat(data.value[0].toFixed(2));var records={data:[0,averagePassStreak]};data.value=data.value[1];var passes=0;for(var i=0;i<data.value.length;i++){passes+=getValue(data.value[i],data.contentFilter.clicked);}records.data[0]=parseInt(passes/data.played);return records;}function LivePassTypesInfoModel(data){function getValue(value,passTypeFilter){if(passTypeFilter){for(var i=0;i<passTypeFilter.value.length;i++){if(passTypeFilter.value[i]==value[passTypeFilter.index]){return value[2][0];}}return 0;}return value[2][0];}if(!data.value||0==data.value.length){return{played:0,data:[0,0]};}var averagePassStreak=parseFloat(data.value[2].toFixed(2));var records={played:data.played,data:[0,averagePassStreak]};data.value=data.value[3];var passes=0;for(var i=0;i<data.value.length;i++){passes+=getValue(data.value[i],data.contentFilter.clicked);}records.data[0]=passes;return records;}function H2HPassTypesModel(data){var records=[0,0,0,0];if(!data.value||0==data.value.length){return records;}data=data.value[1];for(var i=0;i<data.length;i++){PassTypesModel(records,data[i]);}return records;}function PassTypesModel(records,data){if("cross"==data[1]){records[0]+=data[2][0];}if("throughball"==data[1]){records[1]+=data[2][0];}if("longball"==data[1]){records[2]+=data[2][0];}if("short"==data[1]){records[3]+=data[2][0];}}function LivePassTypesModel(data){var records=[0,0,0,0];if(!data.value||0==data.value.length){return records;}data=data.value[3];for(var i=0;i<data.length;i++){PassTypesModel(records,data[i]);}return records;}function H2HGoalTypesModel(data){var records=[0,0,0,0,0];if(!data.value||0==data.value.length){return records;}var values=data.value[0];data.contentFilter={goal:{index:0,value:"goal"}};for(var i=0;i<values.length;i++){GoalTypesModel(records,values[i],data.contentFilter);}return records;}function GoalTypesModel(records,data,contentFilter){function getValue(value,filters){if(filters&&0!=filters.length){for(var filter in filters){if(filters[filter].value==value[filters[filter].index]){return value[3][0];}}return 0;}return value[3][0];}if("openplay"==data[1]){records[0]+=getValue(data,contentFilter);}if("corner"==data[1]||"crossedfreekick"==data[1]||"throwin"==data[1]||"directfreekick"==data[1]){records[1]+=getValue(data,contentFilter);}if("fastbreak"==data[1]){records[2]+=getValue(data,contentFilter);}if("penalty"==data[1]){records[3]+=getValue(data,contentFilter);}if("owngoal"==data[1]){records[4]+=getValue(data,contentFilter);}}function LiveGoalTypesModel(data){var records=[0,0,0,0,0];if(!data.value||0==data.value.length){return records;}var values=data.value[2];for(var i=0;i<values.length;i++){GoalTypesModel(records,values[i],data.contentFilter);}return records;}function H2HPhysicalModel(data){function getValue(value,index,filters){if(filters&&0!=filters.length){for(var filter in filters){if(filters[filter].value==value[filters[filter].index]||"all"==filters[filter].value){return value[index];}}return 0;}return value[index];}var records=[0,0];var values=data.value[0];var height=0,weight=0,count=0;for(var i=0;i<values.length;i++){var h=getValue(values[i],2,data.contentFilter);var w=getValue(values[i],3,data.contentFilter);if(0!=h&&0!=w){height+=h;weight+=w;count++;}}if(0!=count){records[0]=parseInt(height/count);records[1]=parseInt(weight/count);}return records;}function LivePhysicalModel(data){function getValue(value,index,filters){if(filters){for(var filter in filters){if(filter&&filters[filter].value==value[filters[filter].index]||"all"==filters[filter].value){return value[index];}}return 0;}return value[index];}var records=[0,0];var values=data.value[0][0][0];var height=0,weight=0,count=0;for(var i=0;i<values.length;i++){var h=getValue(values[i],1,data.contentFilter);var w=getValue(values[i],2,data.contentFilter);if(0!=h&&0!=w){height+=h;weight+=w;count++;}}records[0]=parseInt(height/count);records[1]=parseInt(weight/count);return records;}function H2HPhysicalInfoModel(data){function getValue(value,filters){if(filters&&0!=filters.length){for(var filter in filters){if(filters[filter].value==value[filters[filter].index]||"all"==filters[filter].value){return value[4];}}return 0;}return value[4];}var records={played:data.played,data:[0,0]};var values=data.value[0];var aerialLost=0,aerialWon=0,duelWon=0,duelLost=0;for(var i=0;i<values.length;i++){if("aerial_lost"==values[i][1]){aerialLost+=getValue(values[i],data.contentFilter);}if("aerial_won"==values[i][1]){aerialWon+=getValue(values[i],data.contentFilter);}if("duel_won"==values[i][1]){duelWon+=getValue(values[i],data.contentFilter);}if("duel_lost"==values[i][1]){duelLost+=getValue(values[i],data.contentFilter);}}var groundWon=(duelWon-aerialWon);var groundLost=(duelLost-aerialLost);if(0!=(aerialWon+aerialLost)){records.data[0]=parseInt(100*aerialWon/(aerialWon+aerialLost));}if(0!=(groundWon+groundLost)){records.data[1]=parseInt(100*(groundWon)/(groundWon+groundLost));}return records;}function LivePhysicalInfoModel(data){function getValue(value,filters){if(filters&&0!=filters.length){for(var filter in filters){if(filters[filter].value==value[filters[filter].index]||"all"==filters[filter].value){return value[2];}}return 0;}return value[2];}var records={played:data.played,data:[0,0]};var values=data.value[0][1][0];var aerialLost=0,aerialWon=0,duelWon=0,duelLost=0;for(var i=0;i<values.length;i++){if("aerial_lost"==values[i][1]){aerialLost+=getValue(values[i],data.contentFilter);}if("aerial_won"==values[i][1]){aerialWon+=getValue(values[i],data.contentFilter);}if("duel_won"==values[i][1]){duelWon+=getValue(values[i],data.contentFilter);}if("duel_lost"==values[i][1]){duelLost+=getValue(values[i],data.contentFilter);}}var groundWon=(duelWon-aerialWon);var groundLost=(duelLost-aerialLost);records.data[0]=0!=aerialWon+aerialLost?parseInt(100*aerialWon/(aerialWon+aerialLost)):0;records.data[1]=0!=(groundWon+groundLost)?parseInt(100*(groundWon)/(groundWon+groundLost)):0;return records;}var LivePlayerStatsSummaryGridDefaults=$.extend({},gridDefaults,{model:{type:LivePlayerStatsSummaryGridModel,cache:true},view:LivePlayerStatsGridView,sorter:{sortInfo:{property:"P",direction:"asc"}}});var LivePlayerStatsDefensiveGridDefaults=$.extend({},gridDefaults,{model:{type:LivePlayerStatsDefensiveGridModel,cache:true},view:LivePlayerStatsGridView,sorter:{sortInfo:{property:"P",direction:"asc"}}});var LivePlayerStatsOffensiveGridDefaults=$.extend({},gridDefaults,{model:{type:LivePlayerStatsOffensiveGridModel,cache:true},view:LivePlayerStatsGridView,sorter:{sortInfo:{property:"P",direction:"asc"}}});var LivePlayerStatsPassingGridDefaults=$.extend({},gridDefaults,{model:{type:LivePlayerStatsPassingGridModel,cache:true},view:LivePlayerStatsGridView,sorter:{sortInfo:{property:"P",direction:"asc"}}});var H2HPlayerStatsSummaryGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsSummaryGridModel,cache:true},view:H2HPlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var TeamPlayerStatsSummaryGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsSummaryGridModel,cache:true},view:TeamPlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var StagePlayerStatsSummaryGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsSummaryGridModel,cache:true},view:StagePlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var StagePlayerStatsDefensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsDefensiveGridModel,cache:true},view:StagePlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var StagePlayerStatsOffensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsOffensiveGridModel,cache:true},view:StagePlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var StagePlayerStatsPassingGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsPassingGridModel,cache:true},view:StagePlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var H2HPlayerStatsDefensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsDefensiveGridModel,cache:true},view:H2HPlayerStatsGridView,sorter:{sortInfo:{property:"TotalTackles",direction:"desc"}}});var TeamPlayerStatsDefensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsDefensiveGridModel,cache:true},view:TeamPlayerStatsGridView,sorter:{sortInfo:{property:"TotalTackles",direction:"desc"}}});var H2HPlayerStatsOffensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsOffensiveGridModel,cache:true},view:H2HPlayerStatsGridView,sorter:{sortInfo:{property:"Goals",direction:"desc"}}});var TeamPlayerStatsOffensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsOffensiveGridModel,cache:true},view:TeamPlayerStatsGridView,sorter:{sortInfo:{property:"Goals",direction:"desc"}}});var H2HPlayerStatsPassingGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsPassingGridModel,cache:true},view:H2HPlayerStatsGridView,sorter:{sortInfo:{property:"Assists",direction:"desc"}}});var TeamPlayerStatsPassingGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsPassingGridModel,cache:true},view:TeamPlayerStatsGridView,sorter:{sortInfo:{property:"Assists",direction:"desc"}}});function getStatValue(stats,type){if(!stats){return 0;}for(var k=0;k<stats.length;k++){if(type==stats[k][0]){return stats[k][1][0];}}return 0;}function getAsFloat(value,total,precision){precision=precision||1;if(0==total){return 0;}return NG.roundNumber((value/total),precision);}function getRealPosition(position){if(!position){return"-";}var startsWith=position.toString().charAt();var orderKeys={"g":"A","d":"B","m":"C","a":"D","f":"E","s":"E","k":"A"};return orderKeys[startsWith.toLowerCase()]+position;}function loadLivePlayerStatisticsEvents(stats,o){if(!o.events){o.events={};}o.events.G={v:getStatValue(stats,"goals")-getStatValue(stats,"att_pen_goal"),d:"goal"};o.events.A={v:getStatValue(stats,"goal_assist"),d:"assist"};o.events.SY={v:getStatValue(stats,"second_yellow"),d:"secondyellow"};if(0==o.events.SY.v){o.events.Y={v:getStatValue(stats,"yellow_card"),d:"yellow"};o.events.R={v:getStatValue(stats,"red_card"),d:"red"};}o.events.PO={v:getStatValue(stats,"post_scoring_att"),d:"shotonpost"};o.events.COL={v:getStatValue(stats,"clearance_off_line"),d:"clearance-off-line"};var penaltyMiss=getStatValue(stats,"att_pen_miss")+getStatValue(stats,"att_pen_post")+getStatValue(stats,"att_pen_target");o.events.PM={v:penaltyMiss,d:"penalty-missed"};o.events.LMT={v:getStatValue(stats,"last_man_tackle"),d:"last-man-tackle"};o.events.PG={v:getStatValue(stats,"att_pen_goal"),d:"penalty-goal"};o.events.PS={v:getStatValue(stats,"penalty_save"),d:"penalty-save"};o.events.ELG={v:getStatValue(stats,"error_lead_to_goal"),d:"error-lead-to-goal"};o.events.LMD={v:getStatValue(stats,"last_man_contest"),d:"last-man-dribble"};o.events.PC={v:getStatValue(stats,"penalty_conceded"),d:"penalty-conceded"};o.events.OG={v:getStatValue(stats,"own_goals"),d:"owngoal"};}function loadLivePlayerStatisticsEventsSummary(stats,o){if(!o.events){o.events={};}o.events.G={v:getStatValue(stats,"goals"),d:"goal"};o.events.SY={v:getStatValue(stats,"second_yellow"),d:"secondyellow"};if(0==o.events.SY.v){o.events.Y={v:getStatValue(stats,"yellow_card"),d:"yellow"};o.events.R={v:getStatValue(stats,"red_card"),d:"red"};}}var positionOrders={"GK":1,"DR":2,"DC":3,"DL":4,"DMR":5,"DMC":6,"DML":7,"MR":8,"MC":9,"ML":10,"AMR":11,"AMC":12,"AML":13,"FWR":14,"FW":15,"FWL":16,"Sub":17};function getPosition(formationPlace,position,rating){var order=positionOrders[position];order=order<10?"0"+order:order;return order+"-"+position;formationPlace=(0==formationPlace)?((rating==0)?13:12):formationPlace;return((formationPlace<10)?"0"+formationPlace:formationPlace)+"-"+position;}function getSubOnOff(stats,matchDuration){var subOn=getStatValue(stats,"total_sub_on");var subOff=getStatValue(stats,"total_sub_off");var minsPlayed=getStatValue(stats,"mins_played");if(0==minsPlayed){return;}if(0!=subOn&&0!=subOff){return[{d:"subst-in",v:""},{d:"subst-out",v:""}];}if(0!=subOn){return[{d:"subst-in",v:(matchDuration-minsPlayed)}];}if(0!=subOff){return[{d:"subst-out",v:minsPlayed}];}}function getMatchDuration(players){var duration=0;for(var i=0;i<players.length;i++){var stats=players[i][3][0];var minsPlayed=getStatValue(stats,"mins_played");if(duration<minsPlayed){duration=minsPlayed;}}return duration;}function LivePlayerStatsSummaryGridModel(){this.load=function(data){var records=[];var values=data[4];for(var i=0;i<values.length;i++){var o={events:{}};var stats=values[i][3][0];var matchDuration=getMatchDuration(values);o.Id=values[i][0];o.PN=values[i][1];o.SubOnOff=getSubOnOff(stats,matchDuration);setIsManOfTheMatch(stats,o);o.P=getPosition(getStatValue(stats,"formation_place"),values[i][5],values[i][2]);o.S=getStatValue(stats,"total_scoring_att");o.SOT=getStatValue(stats,"ontarget_scoring_att");o.KP=getStatValue(stats,"total_att_assist");var totalPass=getStatValue(stats,"total_pass");var accuratePass=getStatValue(stats,"accurate_pass");o.PA=getPercentage(accuratePass,totalPass);var duelWon=getStatValue(stats,"duel_won");var duelLost=getStatValue(stats,"duel_lost");var aerialWon=getStatValue(stats,"aerial_won");o.AD=aerialWon;o.TCH=getStatValue(stats,"touches");o.AR=values[i][2]?values[i][2]:0;loadLivePlayerStatisticsEvents(stats,o);records.push(o);}return records;};}function LivePlayerStatsDefensiveGridModel(){this.load=function(data){var records=[];var values=data[4];for(var i=0;i<values.length;i++){var o={events:{}};var stats=values[i][3][0];var matchDuration=getMatchDuration(values);o.Id=values[i][0];o.PN=values[i][1];o.SubOnOff=getSubOnOff(stats,matchDuration);setIsManOfTheMatch(stats,o);o.P=getPosition(getStatValue(stats,"formation_place"),values[i][5],values[i][2]);o.TAC=getStatValue(stats,"total_tackle");o.INTC=getStatValue(stats,"interception");o.TC=getStatValue(stats,"total_clearance");o.EC=getStatValue(stats,"effective_clearance");o.SB=getStatValue(stats,"outfielder_block");o.OW=getStatValue(stats,"offside_provoked");o.F=getStatValue(stats,"fouls");o.AR=values[i][2];loadLivePlayerStatisticsEvents(stats,o);records.push(o);}return records;};}function LivePlayerStatsOffensiveGridModel(){this.load=function(data){var records=[];var values=data[4];for(var i=0;i<values.length;i++){var o={events:{}};var stats=values[i][3][0];var matchDuration=getMatchDuration(values);o.Id=values[i][0];o.PN=values[i][1];o.SubOnOff=getSubOnOff(stats,matchDuration);setIsManOfTheMatch(stats,o);o.P=getPosition(getStatValue(stats,"formation_place"),values[i][5],values[i][2]);o.S=getStatValue(stats,"total_scoring_att");o.SOT=getStatValue(stats,"ontarget_scoring_att");o.KP=getStatValue(stats,"total_att_assist");o.SD=getStatValue(stats,"won_contest");o.WF=getStatValue(stats,"was_fouled");o.DS=getStatValue(stats,"dispossessed");o.T=getStatValue(stats,"turnover");o.OFF=getStatValue(stats,"total_offside");o.AR=values[i][2];loadLivePlayerStatisticsEvents(stats,o);records.push(o);}return records;};}function LivePlayerStatsPassingGridModel(){this.load=function(data){var records=[];var values=data[4];for(var i=0;i<values.length;i++){var o={events:{}};var stats=values[i][3][0];var matchDuration=getMatchDuration(values);o.Id=values[i][0];o.PN=values[i][1];o.SubOnOff=getSubOnOff(stats,matchDuration);setIsManOfTheMatch(stats,o);o.P=getPosition(getStatValue(stats,"formation_place"),values[i][5],values[i][2]);o.KP=getStatValue(stats,"total_att_assist");var totalPass=getStatValue(stats,"total_pass");var accuratePass=getStatValue(stats,"accurate_pass");o.TP=totalPass;o.PA=getPercentage(accuratePass,totalPass);o.TC=getStatValue(stats,"total_cross");o.CA=getStatValue(stats,"accurate_cross");o.TLB=getStatValue(stats,"total_long_balls");o.LBA=getStatValue(stats,"accurate_long_balls");o.TTB=getStatValue(stats,"total_through_ball");o.TBA=getStatValue(stats,"accurate_through_ball");o.AR=values[i][2];loadLivePlayerStatisticsEvents(stats,o);records.push(o);}return records;};}function LivePlayerStatsGridView(data){var records=data.model.records;if(records){var o,t=[];for(var i=0,l=records.length;i<l;i++){o=records[i];t.push('<tr class="'+((1==i%2)?"alt":"")+" "+((0==parseInt(o.AR))?"inactive":"")+" "+(o.IsManOfTheMatch?"man-of-the-match":"")+'">');t.push('<td class="rank">'+(i+1)+"</td>");for(var stat in o){if("events"!=stat){if("P"==stat){t.push('<td class="'+stat.toString().toLowerCase()+'">'+o[stat].substring(3,o[stat].length)+"</td>");}else{if("RT"==stat){t.push('<td class="'+stat.toString().toLowerCase()+'">'+getRatingDisplayValue(o[stat])+"</td>");}else{if("PN"==stat){var subOnOff=o.SubOnOff;t.push('<td class="'+stat.toString().toLowerCase()+'">');t.push(WS.PlayerLink(o.Id,o[stat]));if(subOnOff){for(var k=0;k<subOnOff.length;k++){t.push('<span style="color: #999; font-weight: normal;" class="iconize iconize-icon-left"><span class="incidents-icon ui-icon '+subOnOff[k].d+'"></span>'+subOnOff[k].v+"'</span>");}}if(o.IsManOfTheMatch){t.push('<span class="iconize iconize-icon-right"><span class="incidents-icon ui-icon mom"></span></span>');}t.push("</td>");}else{if("IsManOfTheMatch"==stat||"SubOnOff"==stat||"ShowRating"==stat||("RT"==stat&&!o.ShowRating)){}else{if("Id"!=stat){t.push('<td class="'+stat.toString().toLowerCase()+'">'+o[stat]+"</td>");}}}}}}}t.push('<td class="live-events">');for(var event in o.events){for(var k=0;k<o.events[event].v;k++){t.push('<span class="incident-wrapper"><span title="'+getIncidentToolTip(o.events[event].d)+'" class="incidents-icon ui-icon '+o.events[event].d+'"></span></span>');}}t.push("</td>");t.push("</tr>");}return t.join("");}return"";}function TeamPlayerStatsSummaryGridModel(){this.load=function(data){var records=[];var isOptaTeam=false;var values=data.value;if(!NG.isArray(values[0])){$("#team-squad-stats").hide();}for(var i=0;i<values.length;i++){var o={};o.PlayerName=values[i][0];o.RealPosition=getRealPosition(values[i][1]);o.RegionCode=values[i][2];o.Age=values[i][3];o.Height=values[i][4];o.Weight=values[i][5];o.FirstEleven=values[i][6];o.Id=values[i][7];o.Sub=values[i][8];o.AP=o.FirstEleven+o.Sub;o.IsCurrent=values[i][9];var stats=values[i][10];o.G=getStatValue(stats,"goals");o.Y=getStatValue(stats,"yellow_card");o.R=getStatValue(stats,"red_card");if(0!=o.AP){var optaRating=getStatValue(stats,"rating");if(0!=optaRating){isOptaTeam=true;o.A=getStatValue(stats,"goal_assist");o.SPG=getAsFloat(getStatValue(stats,"total_scoring_att"),o.AP);o.AR=getAsFloat(optaRating,o.AP,2);o.MOM=getStatValue(stats,"man_of_the_match");var aerialWon=getStatValue(stats,"aerial_won");var aerialLost=getStatValue(stats,"aerial_lost");o.ADS=getPercentage(aerialWon,(aerialWon+aerialLost));var totalPass=getStatValue(stats,"total_pass");var accuratePass=getStatValue(stats,"accurate_pass");o.PS=getPercentage(accuratePass,totalPass);}}o.IsOptaTeam=isOptaTeam;records.push(o);}if("TeamPlayersTopListsPresenter"!=data.caller){$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);}return records;};}function H2HPlayerStatsSummaryGridView(data){var records=data.model.records;if(records){var o,t=[];for(var i=0,l=records.length;i<l;i++){o=records[i];t.push('<tr class="'+((1==i%2)?"alt":"")+'">');t.push('<td class="rank">'+(i+1)+"</td>");t.push('<td class="pn">'+o.PlayerName+"</td>");t.push('<td class="pos">'+getRealPositionShortName(o.RealPosition.substring(1,o.RealPosition.length))+"</td>");t.push('<td class="ap">'+o.AP+"</td>");t.push('<td class="g">'+o.G+"</td>");t.push('<td class="a">'+o.A+"</td>");t.push('<td class="y">'+o.Y+"</td>");t.push('<td class="r">'+o.R+"</td>");t.push('<td class="spg">'+o.SPG+"</td>");t.push('<td class="ps">'+o.PS+"</td>");t.push('<td class="ads">'+o.ADS+"</td>");t.push('<td class="mom">'+o.MOM+"</td>");t.push('<td class="ar">'+getRatingDisplayValue(o.AR)+"</td>");t.push("</tr>");}return t.join("");}return"";}var realPositionShortNames={"goalkeeper":"Gk","defender":"Def","midfielder":"Mid","forward":"Fw","keeper":"Gk"};function getRealPositionShortName(realPosition){return realPositionShortNames[realPosition.toLowerCase()]?realPositionShortNames[realPosition.toLowerCase()]:"-";}function TeamPlayerStatsSummaryGridView(data){var records=data.model.records;if(records){var o,t=[];for(var i=0,l=records.length;i<l;i++){o=records[i];t.push('<tr class="'+(o.IsCurrent==0?" not-current-player ":"")+((1==i%2)?"alt":"")+'">');t.push('<td class="rank">'+(i+1)+"</td>");t.push('<td class="rgn"><span class="ui-icon country flg-'+o.RegionCode+'"></td>');t.push('<td class="pn">'+WS.PlayerLink(o.Id,o.PlayerName)+"</td>");t.push('<td class="pos">'+getRealPositionShortName(o.RealPosition.substring(1,o.RealPosition.length))+"</td>");t.push('<td class="age">'+o.Age+"</td>");t.push('<td class="hg">'+o.Height+"</td>");t.push('<td class="wg">'+o.Weight+"</td>");if(o.IsOptaTeam){t.push('<td class="ap">'+o.FirstEleven+(0!=o.Sub?"("+o.Sub+")":"")+"</td>");t.push('<td class="g">'+o.G+"</td>");t.push('<td class="a">'+o.A+"</td>");t.push('<td class="y">'+o.Y+"</td>");t.push('<td class="r">'+o.R+"</td>");t.push('<td class="spg">'+o.SPG+"</td>");t.push('<td class="ps">'+o.PS+"</td>");t.push('<td class="ads">'+o.ADS+"</td>");t.push('<td class="mom">'+o.MOM+"</td>");t.push('<td class="ar">'+getRatingDisplayValue(o.AR)+"</td>");}else{t.push('<td style="display: none;" class="ap"></td>');t.push('<td class="g">'+o.G+"</td>");t.push('<td class="y">'+o.Y+"</td>");t.push('<td class="r">'+o.R+"</td>");}t.push("</tr>");}return t.join("");}return"";}function TeamPlayerStatsDefensiveGridModel(){this.load=function(data){var records=[];var isOptaTeam=false;var values=data.value;for(var i=0;i<values.length;i++){var o={};o.PlayerName=values[i][0];o.RealPosition=getRealPosition(values[i][1]);o.RegionCode=values[i][2];o.Age=values[i][3];o.Height=values[i][4];o.Weight=values[i][5];o.FirstEleven=values[i][6];o.Id=values[i][7];o.Sub=values[i][8];o.AP=o.FirstEleven+o.Sub;o.IsCurrent=values[i][9];if(0!=o.AP){var stats=values[i][10];var optaRating=getStatValue(stats,"rating");if(0!=optaRating){isOptaTeam=true;o.AR=NG.getAverage(optaRating,o.AP,2);o.TPG=NG.getAverage(getStatValue(stats,"total_tackle"),o.AP,1);o.IPG=NG.getAverage(getStatValue(stats,"interception"),o.AP,1);o.CPG=NG.getAverage(getStatValue(stats,"total_clearance"),o.AP,1);o.BRPG=NG.getAverage(getStatValue(stats,"ball_recovery"),o.AP,1);o.BSPG=NG.getAverage(getStatValue(stats,"outfielder_block"),o.AP,1);o.OWPG=NG.getAverage(getStatValue(stats,"offside_provoked"),o.AP,1);o.DRB=NG.getAverage(getStatValue(stats,"challenge_lost"),o.AP,1);o.FPG=NG.getAverage(getStatValue(stats,"fouls"),o.AP,1);o.OG=getStatValue(stats,"own_goals");}}o.IsOptaTeam=isOptaTeam;records.push(o);}$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return records;};}function TeamPlayerStatsDefensiveGridView(data){var records=data.model.records;if(records){var o,t=[];for(var i=0,l=records.length;i<l;i++){o=records[i];t.push('<tr class="'+(o.IsCurrent==0?" not-current-player ":"")+((1==i%2)?"alt":"")+'">');t.push('<td class="rank">'+(i+1)+"</td>");t.push('<td class="rgn"><span class="country flg-'+o.RegionCode+' iconize iconize-icon-left"></td>');t.push('<td class="pn">'+WS.PlayerLink(o.Id,o.PlayerName)+"</td>");t.push('<td class="pos">'+getRealPositionShortName(o.RealPosition.substring(1,o.RealPosition.length))+"</td>");t.push('<td class="ap">'+o.FirstEleven+(0!=o.Sub?"("+o.Sub+")":"")+"</td>");t.push('<td class="tpg">'+o.TPG+"</td>");t.push('<td class="ipg">'+o.IPG+"</td>");t.push('<td class="fpg">'+o.FPG+"</td>");t.push('<td class="owpg">'+o.OWPG+"</td>");t.push('<td class="cpg">'+o.CPG+"</td>");t.push('<td class="drb">'+o.DRB+"</td>");t.push('<td class="bspg">'+o.BSPG+"</td>");t.push('<td class="og">'+o.OG+"</td>");t.push('<td class="ar">'+getRatingDisplayValue(o.AR)+"</td>");t.push("</tr>");}return t.join("");}return"";}function TeamPlayerStatsOffensiveGridModel(){this.load=function(data){var records=[];var isOptaTeam=false;var values=data.value;for(var i=0;i<values.length;i++){var o={};o.PlayerName=values[i][0];o.RealPosition=getRealPosition(values[i][1]);o.RegionCode=values[i][2];o.Age=values[i][3];o.Height=values[i][4];o.Weight=values[i][5];o.FirstEleven=values[i][6];o.Id=values[i][7];o.Sub=values[i][8];o.AP=o.FirstEleven+o.Sub;o.IsCurrent=values[i][9];if(0!=o.AP){var stats=values[i][10];var optaRating=getStatValue(stats,"rating");if(optaRating){isOptaTeam=true;o.AR=NG.getAverage(optaRating,o.AP,2);o.G=getStatValue(stats,"goals");o.A=getStatValue(stats,"goal_assist");o.SPG=NG.getAverage(getStatValue(stats,"total_scoring_att"),o.AP,1);o.KPPG=NG.getAverage(getStatValue(stats,"total_att_assist"),o.AP,1);o.SDPG=NG.getAverage(getStatValue(stats,"won_contest"),o.AP,1);o.WFPG=NG.getAverage(getStatValue(stats,"was_fouled"),o.AP,1);o.OGPG=NG.getAverage(getStatValue(stats,"total_offside"),o.AP,1);o.DPG=NG.getAverage(getStatValue(stats,"dispossessed"),o.AP,1);o.TPG=NG.getAverage(getStatValue(stats,"turnover"),o.AP);}}o.IsOptaTeam=isOptaTeam;records.push(o);}$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return records;};}function TeamPlayerStatsOffensiveGridView(data){var records=data.model.records;if(records){var o,t=[];for(var i=0,l=records.length;i<l;i++){o=records[i];t.push('<tr class="'+(o.IsCurrent==0?" not-current-player ":"")+((1==i%2)?"alt":"")+'">');t.push('<td class="rank">'+(i+1)+"</td>");t.push('<td class="rgn"><span class="country flg-'+o.RegionCode+' iconize iconize-icon-left"></td>');t.push('<td class="pn">'+WS.PlayerLink(o.Id,o.PlayerName)+"</td>");t.push('<td class="pos">'+getRealPositionShortName(o.RealPosition.substring(1,o.RealPosition.length))+"</td>");t.push('<td class="ap">'+o.FirstEleven+(0!=o.Sub?"("+o.Sub+")":"")+"</td>");t.push('<td class="g">'+o.G+"</td>");t.push('<td class="a">'+o.A+"</td>");t.push('<td class="spg">'+o.SPG+"</td>");t.push('<td class="kppg">'+o.KPPG+"</td>");t.push('<td class="sdpg">'+o.SDPG+"</td>");t.push('<td class="wfpg">'+o.WFPG+"</td>");t.push('<td class="ogpg">'+o.OGPG+"</td>");t.push('<td class="dpg">'+o.DPG+"</td>");t.push('<td class="tpg">'+o.TPG+"</td>");t.push('<td class="ar">'+getRatingDisplayValue(o.AR)+"</td>");t.push("</tr>");}return t.join("");}return"";}function TournamentFormationPresenter(config){var id,$view;init(config);function init(config){id=config.view.renderTo;$view=$("#"+id);}this.id=function(){return id;};this.load=function(data){var tournamentFormation=TournamentFormationModel(data);if(tournamentFormation){var formation=data.params.formation;clearView();renderDates(tournamentFormation.dates);render(tournamentFormation.players,formation);}else{$("#tournament-formation-filter-type dd:has(a[data-source="+data.filter.data.type+"])").remove();$("#tournament-formation-filter-type a:first").click();}};function clearView(){$("#tournament-formation-dates-header").remove();}function renderDates(dates){var html=[];html.push('<div id="tournament-formation-dates-header">');if(1==dates.length){html.push(dates[0]);}else{if(dates[0]==dates[1]){html.push(dates[0]);}else{html.push(dates[0]+" / "+dates[1]);}}html.push("</div>");$view.before(html.join(""));}function render(players,formation){var html=[],pitchDimensions=getPitchDimensions();var formationPitchView=new FormationPitchView({pitchDimensions:pitchDimensions,formationCoordinates:formation[1],showTeam:true});$view.html(formationPitchView.getHtml(players));}function getPitchDimensions(){if(!$view){return;}return{width:$view.width(),height:400};}}function TournamentFormationModel(data){var players=data.value[0];var dates=data.value[1];if(!players||!dates){return;}if(0==players.length||0==dates.length){return;}var records={players:{},dates:[]};for(var i=0;i<players.length;i++){records.players[i+1]={TeamId:players[i][0],TeamName:players[i][1],Id:players[i][2],Name:players[i][3],PositionText:players[i][4],Position:i+1,Apps:players[i][5],Rating:players[i][6]};}records.dates=dates;return records;}function TeamFormationPresenter(config){var id,$view,$filters,lastStatType;init(config);function init(config){id=config.view.renderTo;$view=$("#"+id);$filters=$("#"+"team-formations-filter");}this.id=function(){return id;};this.load=function(data){var formationsCoordinates=data.params.formations;var formationFilter=data.filter.content.formation;var statType=data.filter.data.type;var showAllPlayers=data.filter.both.type=="all";var selectedFormation;clearPitch(statType);if(!showAllPlayers){prepareViewForFormations();if("32"==statType){selectedFormation=prepareBestEleven(data);}else{var records=prepareData(data);var selectedFormation=getFormationByFilter(records,formationFilter);if("16"==statType){renderFormations(records,statType,formationFilter);}renderSelectedFormationInfo(selectedFormation);$(document).triggerHandler("fix-zeros",[$("#team-formation-stats td")]);}selectedFormation.Players=pickBestElevenPlayers(selectedFormation.Players);var selectedFormationCoordinates=getSelectedFormationCoordinates(formationsCoordinates,selectedFormation.Name);renderPlayers(selectedFormation.Players,selectedFormationCoordinates);}else{prepareViewForAllPlayers();var records=prepareData(data);var players={};for(var i=0;i<records.length;i++){var formation=records[i];var selectedFormationCoordinates=getSelectedFormationCoordinates(formationsCoordinates,formation.Name);for(var k=0;k<formation.Players.length;k++){var player=formation.Players[k];var playerCoordinates=selectedFormationCoordinates[player.Position-1];if(!players[player.PositionText]){players[player.PositionText]={Coordinates:{minVertical:playerCoordinates[0],maxVertical:playerCoordinates[0],minHorizontal:playerCoordinates[1],maxHorizontal:playerCoordinates[1]},Players:[],DisplayPosition:player.PositionText};}if(!playerPushedForPosition(players[player.PositionText].Players,player)){players[player.PositionText].Players.push(player);}else{var index=playerIndexInPosition(players[player.PositionText].Players,player);var positionPlayer=players[player.PositionText].Players[index];positionPlayer.Rating=(((positionPlayer.Rating*positionPlayer.Apps)+(player.Rating*player.Apps))/(positionPlayer.Apps+player.Apps));positionPlayer.Apps+=player.Apps;players[player.PositionText].Players[index]=positionPlayer;}}}renderAllPlayers(players);}lastStatType=statType;};function prepareViewForAllPlayers(){$view.removeClass("pitch").addClass("all-players");}function prepareViewForFormations(){$view.removeClass("all-players").addClass("pitch");}function playerPushedForPosition(players,player){for(var i=0;i<players.length;i++){if(players[i].Id==player.Id){return true;}}return false;}function playerIndexInPosition(players,player){for(var i=0;i<players.length;i++){if(players[i].Id==player.Id){return i;}}}function clearPitch(statType){$(".team-pitch-formation",$view).remove();$("#team-formations-filter-formation").remove();$("#team-formation-stats").remove();$("#team-formations .match-name").remove();$view.height(400);}function renderSelectedFormationInfo(selectedFormation){var formationInfoHtml=[];if(selectedFormation.MatchName){formationInfoHtml.push('<div class="match-name">'+selectedFormation.MatchName+"</div>");}formationInfoHtml.push('<table id="team-formation-stats" class="grid with-centered-columns"');formationInfoHtml.push("<thead>");formationInfoHtml.push("<tr>");formationInfoHtml.push("<th>Formation</th>");formationInfoHtml.push("<th>Rating</th>");formationInfoHtml.push("<th>Apps</th>");formationInfoHtml.push("<th>Scored</th>");formationInfoHtml.push("<th>Conceded</th>");formationInfoHtml.push('<th class="form"><span class=" box w">w</span></th>');formationInfoHtml.push('<th class="form"><span class=" box d">d</span></th>');formationInfoHtml.push('<th class="form"><span class=" box l">l</span></th>');formationInfoHtml.push("</tr>");formationInfoHtml.push("</thead>");formationInfoHtml.push("<tbody>");formationInfoHtml.push("<td>"+selectedFormation.Name+"</td>");formationInfoHtml.push("<td>"+selectedFormation.Rating+"</td>");formationInfoHtml.push("<td>"+selectedFormation.Occurence+"</td>");formationInfoHtml.push("<td>"+selectedFormation.Scored+"</td>");formationInfoHtml.push("<td>"+selectedFormation.Conceded+"</td>");formationInfoHtml.push("<td>"+selectedFormation.Win+"</td>");formationInfoHtml.push("<td>"+selectedFormation.Draw+"</td>");formationInfoHtml.push("<td>"+selectedFormation.Lose+"</td>");formationInfoHtml.push("</tbody>");formationInfoHtml.push("</table>");return $view.before(formationInfoHtml.join(""));}function getSelectedFormationCoordinates(formations,selectedFormationName){for(var i=0;i<formations.length;i++){if(formations[i][0]==selectedFormationName){return formations[i][1];}}}function getPitchDimensions(){if(!$view){return;}return{width:$view.width(),height:400};}var positionCoordinates={GoalKeeper:{"GK":{width:5,colspan:3}},Defensive:{"DR":{width:3},"DC":{width:5},"DL":{width:3}},DefensiveMidfield:{"DMR":{width:3},"DMC":{width:5},"DML":{width:3}},Midfield:{"MR":{width:3},"MC":{width:5},"ML":{width:3}},AttackingMidfield:{"AMR":{width:3},"AMC":{width:5},"AML":{width:3}},Forward:{"FWR":{width:3},"FW":{width:5},"FWL":{width:3}}};function getPositionCoordinates(position){return positonCoordinates[position];}function renderAllPlayers(positions){var pitchDimensions=getPitchDimensions();var formationGridView=new FormationGridView({pitchDimensions:pitchDimensions,positionCoordinates:positionCoordinates});$view.height("100%");$view.append(formationGridView.getHtml(positions));formationGridView.loadGrids();}function renderPlayers(players,formationCoordinates){var html=[],pitchDimensions=getPitchDimensions();var formationPitchView=new FormationPitchView({pitchDimensions:pitchDimensions,formationCoordinates:formationCoordinates});$view.append(formationPitchView.getHtml(players));$view.trigger("rendered");}function getFormationByFilter(records,formationName){for(var i=0;i<records.length;i++){if(formationName==records[i].Name){return records[i];}}return records[0];}function pickBestElevenPlayers(players){var playersGroupedByPosition=groupPlayersByPosition(players);var pickedPlayers={};for(var i=0;i<11;i++){pickPlayerForPosition(pickedPlayers,playersGroupedByPosition,i+1);}return pickedPlayers;}function pickPlayerForPosition(pickedPlayers,playersGroupedByPosition,position){var player=pickTopPlayerForPosition(playersGroupedByPosition,position);if(!player){return;}var playerAsPickedBeforePosition=getPlayerPositionIfAlreadyPicked(pickedPlayers,player);if(playerAsPickedBeforePosition){var playerAsPickedBefore=pickedPlayers[playerAsPickedBeforePosition];var playerToPick=selectPlayerToPick(playersGroupedByPosition,player,playerAsPickedBefore);if(playerToPick.Position==player.Position){removePlayerFromPosition(playersGroupedByPosition,playerAsPickedBefore.Position);pickPlayerForPosition(pickedPlayers,playersGroupedByPosition,playerAsPickedBefore.Position);pickedPlayers[playerToPick.Position]=playerToPick;}else{removePlayerFromPosition(playersGroupedByPosition,player.Position);pickPlayerForPosition(pickedPlayers,playersGroupedByPosition,player.Position);}}else{pickedPlayers[position]=player;}}function selectPlayerToPick(playersGroupedByPosition,player,playerAsPickedBefore){var playersInPlayerPosition=playersGroupedByPosition[player.Position].length;var playersInPlayerAsPickedBeforePosition=playersGroupedByPosition[playerAsPickedBefore.Position].length;if(playersInPlayerPosition<2){return playerAsPickedBefore;}if(playersInPlayerAsPickedBeforePosition<2){return player;}return playerAsPickedBefore.Apps<player.Apps?player:(player.Apps<playerAsPickedBefore.Apps?playerAsPickedBefore:(player.Rating<=playerAsPickedBefore.Rating?playerAsPickedBefore:player));}function pickTopPlayerForPosition(playersGroupedByPosition,positionToPick){return playersGroupedByPosition[positionToPick][0];}function removePlayerFromPosition(playersGroupedByPosition,position,player){playersGroupedByPosition[position].shift();}function getPlayerPositionIfAlreadyPicked(pickedPlayers,player){for(var pickedPlayer in pickedPlayers){if(pickedPlayers[pickedPlayer]){if(pickedPlayers[pickedPlayer].Id==player.Id){return pickedPlayers[pickedPlayer].Position;}}}}function groupPlayersByPosition(players){var positions={};for(var i=0;i<players.length;i++){var player=players[i];if(!positions[player.Position]){positions[player.Position]=[];}positions[player.Position].push(player);}return positions;}function renderFormations(formations,statType,selectedFormationName){var formationsHtml=[];formationsHtml.push('<div class="grid-toolbar" id="team-formations-filter-formation">');formationsHtml.push('<dl class="listbox left">');formationsHtml.push("<dt>Formations:</dt>");var selectFirst=(lastStatType!=statType);for(var i=0;i<formations.length;i++){formationsHtml.push("<dd>");if(selectFirst&&i==0){formationsHtml.push('<a data-value="'+i+'" data-source="'+formations[i].Name+'" href="#" class="option selected'+'">'+formations[i].Name+" ("+formations[i].Occurence+")</a>");}else{formationsHtml.push('<a data-value="'+i+'" data-source="'+formations[i].Name+'" href="#" class="option '+(selectedFormationName==formations[i].Name?"selected":"")+'">'+formations[i].Name+" ("+formations[i].Occurence+")</a>");}formationsHtml.push("</dd>");}formationsHtml.push("</dl>");formationsHtml.push("</div>");$filters.append(formationsHtml.join(""));$("#team-formations-filter").triggerHandler("refresh-filters",["team-formations-filter-formation"]);}function getWDLOccurence(results,resultType){for(var i=0;i<results.length;i++){if(resultType==results[i][0]){return results[i][1];}}return 0;}function getPlayerFromData(playerData){return{Id:playerData[0],Name:playerData[1],Position:playerData[2],Rating:playerData[3],ShirtNo:playerData[4]?playerData[4]:"",PositionText:playerData[5],Apps:playerData[6]};}function prepareBestEleven(data){var records={Players:[]};var formation=data.value[0];var players=data.value[1];records.Name=formation[0];for(var i=0;i<players.length;i++){records.Players.push(getPlayerFromData(players[i]));}return records;}function prepareData(data,contentFilters){var records=[];var formations=data.value;for(var i=0;i<formations.length;i++){var formationData=formations[i];var formation={Name:formationData[0],Rating:formationData[1],Occurence:formationData[2],Scored:formationData[3],Conceded:formationData[4],Draw:getWDLOccurence(formationData[5],0),Win:getWDLOccurence(formationData[5],1),Lose:getWDLOccurence(formationData[5],2),MatchName:formationData[7]?formationData[7][0]:null,Players:[]};for(var j=0;j<formationData[6].length;j++){var playerData=formationData[6][j];formation.Players.push(getPlayerFromData(playerData));}records.push(formation);}return records;}}function FormationPitchView(config){var formationCoordinates,pitchDimensions,showTeam;init(config);function init(config){formationCoordinates=config.formationCoordinates;pitchDimensions=config.pitchDimensions;showTeam=config.showTeam;}this.getHtml=function(players){var cellWidth=pitchDimensions.width/11,cellHeight=pitchDimensions.height/11;var viewDimensions={cellWidth:cellWidth,cellHeight:cellHeight,pitchDimensions:pitchDimensions};var html=[];var html=[];html.push('<div class="team-pitch-formation">');for(var playerPosition in players){var player=players[playerPosition];player.Coordinates=formationCoordinates[player.Position-1];html.push(getPlayerHtml(player,viewDimensions));}html.push("</div>");return html.join("");};function getPlayerHtml(player,viewDimensions){var playerHtml=[];var formationPosition=player.Coordinates;var vertical=formationPosition[0]*viewDimensions.cellHeight-25;var horizontal=formationPosition[1]*viewDimensions.cellWidth-5;playerHtml.push('<ul class="player-wrapper" title="'+player.Name+": Rating: "+player.Rating+(player.Apps?(" | Appearances: "+player.Apps):"")+'"');playerHtml.push('style="top: '+vertical+"px; left: "+horizontal+'px;">');playerHtml.push("<li>");playerHtml.push('<span class="player'+(showTeam?" as-team-member":"")+'">');if(!showTeam){playerHtml.push('<span class="shirt-no">'+player.ShirtNo+"</span>");}else{playerHtml.push(WS.TeamEmblemUrl(player.TeamId,player.TeamName));}playerHtml.push("</span>");playerHtml.push("</li>");if(player.TeamId){playerHtml.push('<li><a href="/Teams/{0}" class="team-link">{1}</a></li>'.format(player.TeamId,player.TeamName));}playerHtml.push("<li>");playerHtml.push(WS.PlayerLink(player.Id,getShortDisplayName(player.Name,true),"player-name"));playerHtml.push("</li>");playerHtml.push('<li class="player-stats" data-playerid="'+player.Id+'"><span class="player-rating rc">'+getRatingDisplayValue(player.Rating,1)+"</span>");playerHtml.push("</li>");playerHtml.push("</ul>");return playerHtml.join("");}}function FormationGridView(config){var pitchDimensions,positionCoordinates,gridFunctions;init(config);function init(config){pitchDimensions=config.pitchDimensions;positionCoordinates=config.positionCoordinates;gridFunctions=[];}this.getHtml=function(positions){var cellWidth=pitchDimensions.width/11,cellHeight=pitchDimensions.height/11;var html=[];html.push('<table class="team-pitch-formation with-three-cols">');html.push("<tbody>");for(var f in positionCoordinates){var formationLine=positionCoordinates[f];html.push("<tr>");for(var p in formationLine){var position=formationLine[p];var positionWithPlayers=positions[p];var id="team-formation-position-"+p;html.push('<td class="col" '+(position.colspan?(' colspan= "'+position.colspan)+'"':"")+">");html.push('<table id="'+id+'" class="team-formations-position grid" '+(position.colspan?(' style="width: '+(position.width*cellWidth)+'px; "'):"")+">");html.push('<thead class="team-formations-position-header">');html.push("<tr>");html.push('<th class="formation-name">'+p+"</th>");html.push('<th class="sortable" data-property="Apps">Apps</th>');html.push('<th class="sortable" data-property="Rating">Rating</th>');html.push("</tr>");html.push("</thead>");html.push('<tbody class="team-formations-position-players">');if(!positionWithPlayers){html.push("<tr>");html.push('<td colspan=3 style="font-size: 0.8em; color: #666;">N/A</td>');html.push("</tr>");}html.push("</tbody>");html.push("</table>");html.push("</td>");if(positionWithPlayers){gridFunctions.push({id:id,players:positionWithPlayers.Players,func:function(id,players){$("#"+id+"").grid($.extend(true,{model:{type:AllPlayersModel,cache:true},view:TeamFormationsAllPlayersView,sorter:{sortInfo:{property:"Apps",direction:"desc"}}}));var positionGrid=$("#"+id).data("grid");positionGrid.load(players);}});}}html.push("</tr>");}html.push("</tbody>");html.push("</table>");return html.join("");};this.loadGrids=function(){for(var i=0;i<gridFunctions.length;i++){gridFunctions[i].func(gridFunctions[i].id,gridFunctions[i].players);}};}function AllPlayersModel(players){this.load=function(players){return players;};}function TeamFormationsAllPlayersView(records){var html=[];var players=records.model.records;var bestRatedPlayerId;var maxRating=0;for(var i=0;i<players.length;i++){if(maxRating<players[i].Rating){bestRatedPlayerId=players[i].Id;maxRating=players[i].Rating;}}for(var i=0;i<players.length;i++){var player=players[i];html.push('<tr class="team-formations-position-player '+((1==i%2)?"alt":"")+'">');html.push('<td style="text-align: left;">'+WS.PlayerLink(player.Id,getShortDisplayName(player.Name),null,player.Name)+"</td>");html.push('<td style="text-align: center;">'+player.Apps+"</td>");html.push('<td style="text-align: center; '+(bestRatedPlayerId==player.Id?" font-weight: bold; color: #8DC63F;":"")+'">'+NG.roundNumber(player.Rating,2)+"</td>");html.push("</tr>");}return html.join("");}function TournamentPlayersTopListPresenter(config){var id,$view;init(config);function init(config){id=config.view.renderTo;$view=$("#"+id);}this.id=function(){return id;};this.load=function(data){var records=prepareData(data);render(records);$("#tournament-top-scorers").grid($.extend(true,{model:{type:AllPlayersModel,cache:true},view:TopScorersTableView,sorter:{sortInfo:{property:"Index",direction:"asc"}}}));var scorersGrid=$("#tournament-top-scorers").data("grid");scorersGrid.load(records.Goals);};function prepareData(data){var records={Goals:[],Cards:[],Shots:[],Assists:[],Ratings:[]};var values=data.value;var goalsData=values[0];for(var i=0;i<goalsData.length;i++){var player=getPlayer(goalsData[i]);player.Goal=goalsData[i][4];player.TeamGoal=goalsData[i][5];player.Contribution=getPercentage(player.Goal,player.TeamGoal);player.Index=(i+1);records.Goals.push(player);}var cardsData=values[1];for(var i=0;i<cardsData.length;i++){var player=getPlayer(cardsData[i]);player.Red=cardsData[i][4];player.Yellow=cardsData[i][5];records.Cards.push(player);}var shotsData=values[2];if(!shotsData){return records;}for(var i=0;i<shotsData.length;i++){var player=getPlayer(shotsData[i]);player.Shots=shotsData[i][4];records.Shots.push(player);}var assistsData=values[3];if(!assistsData){return records;}for(var i=0;i<assistsData.length;i++){var player=getPlayer(assistsData[i]);player.Assist=assistsData[i][4];records.Assists.push(player);}var ratingData=values[4];if(!ratingData){return records;}for(var i=0;i<ratingData.length;i++){var player=getPlayer(ratingData[i]);player.FirstEleven=ratingData[i][4];player.Sub=ratingData[i][5];player.Apps=player.FirstEleven+player.Sub;player.Rating=ratingData[i][6];records.Ratings.push(player);}return records;}function getPlayer(playerData){return{TeamId:playerData[0],TeamName:playerData[1],TeamShortName:getShortDisplayName(playerData[1]),PlayerId:playerData[2],PlayerName:playerData[3],PlayerShortName:getShortDisplayName(playerData[3])};}function render(records){var html=[];html.push('<table id="tournament-top-scorers" class="grid with-centered-columns">');html.push("<thead>");html.push("<tr>");html.push('<th class="sortable o" data-property="Index">R</th>');html.push('<th class="pn">Player</th>');html.push('<th class="tn">Team</th>');html.push('<th class="sortable goal" data-property="Goal">Player Goals/Team Goals</th>');html.push('<th class="sortable con" data-property="Contribution">Contribution</th>');html.push("</tr>");html.push("</thead>");html.push("<tbody>");html.push("</tbody>");html.push("</table>");html.push('<table class="ws-list-grid with-two-cols">');html.push("<tr>");var listConfig={view:{options:{displayFunction:function(player){return'<span title="'+player.PlayerName+'" class="player-name">'+WS.PlayerLink(player.PlayerId,player.PlayerShortName)+"</span></td>"+'<td class="tn" title="'+player.TeamName+'"><a href="/Teams/'+player.TeamId+'" class="team-link">'+player.TeamShortName+"</a>";}}}};var listWithBarsConfig={type:WS.ListType.BarWithPercentage,view:{options:{displayFunction:function(player){return'<span title="'+player.PlayerName+'" class="player-name">'+WS.PlayerLink(player.PlayerId,player.PlayerShortName)+"</span></td>"+'<td class="tn" title="'+player.TeamName+'"><a href="/Teams/'+player.TeamId+'" class="team-link">'+player.TeamShortName+"</a>";},columns:2,width:$view.width()*(2/3),barClass:"value"}}};if(0!=records.Shots.length){html.push('<td class="col">');html.push(new WS.List(jQuery.extend({},listConfig,{titles:["Aggression","","",""],statTypes:["Yellow","Red"],statTypeClasses:["yellow-card-box","red-card-box"]})).getHtml(records.Cards));html.push("</td>");html.push('<td class="col">');html.push(new WS.List(jQuery.extend({},listWithBarsConfig,{titles:["Shots per game","",""],useValues:true,statTypes:["Shots"]})).getHtml(records.Shots));html.push("</td>");}html.push("</tr>");html.push("<tr>");if(0!=records.Assists.length&&0!=records.Ratings.length){html.push('<td class="col">');html.push(new WS.List(jQuery.extend({},listWithBarsConfig,{titles:["Assists","",""],useValues:true,statTypes:["Assist"]})).getHtml(records.Assists));html.push("</td>");html.push('<td id="tournament-player-ratings" class="col">');html.push(new WS.List(jQuery.extend({},listConfig,{titles:["Performance","",'<span title="Appearances">Apps</span>','<span title="Average Rating">Rt</span>'],statTypes:["Apps","Rating"],statDisplayFunction:function(player){return'<span class="stat-value number apps-in-ratings">'+player.FirstEleven+(player.Sub?("("+player.Sub+")"):"")+'</span></td><td><span class="stat-value number rating">'+player.Rating.toFixed(2)+"</span>";},footer:{text:"*Ordered by appearance weighted ratings",clazz:"info"}})).getHtml(records.Ratings));html.push("</td>");}html.push("</tr>");html.push("</table>");$view.html(html.join(""));}}function TopScorersTableView(data){var t=[];var scorers=data.model.records;var maxTeamGoal=0;for(var i=0;i<scorers.length;i++){if(maxTeamGoal<scorers[i].TeamGoal){maxTeamGoal=scorers[i].TeamGoal;}}for(var i=0;i<scorers.length;i++){var s=scorers[i];t.push('<tr class="'+((1==i%2)?"alt":"")+'">');t.push('<td class="o">'+s.Index+"</td>");t.push('<td title="'+s.PlayerName+'"class="pn">'+WS.PlayerLink(s.PlayerId,s.PlayerShortName)+"</td>");t.push('<td class="tn"><span class="tn" title="'+s.TeamName+'"><a href="/Teams/'+s.TeamId+'" class="team-link">'+s.TeamShortName+"</a></span></td>");t.push('<td class="value">');var teamWidth=(300/100)*getPercentage(s.TeamGoal,maxTeamGoal);var playerWidth=(300/100)*getPercentage(s.Goal,maxTeamGoal);t.push('<span class="stat-bar-wrapper" style="width: '+teamWidth+'px;">');t.push('<span class="stat-bar rc-r" style="width: '+playerWidth+'px;">');t.push('<span class="stat-value">'+s.Goal+"</span>");t.push("</span>");t.push('<span class="outer-value">'+s.TeamGoal+"</span>");t.push("</span>");t.push('<td class="con">'+s.Contribution+"%</td>");t.push("</tr>");}return t.join("");}function TournamentTeamsTopListPresenter(config){var id,$view;init(config);function init(config){id=config.view.renderTo;$view=$("#"+id);}this.id=function(){return id;};this.load=function(data){var records=prepareData(data);render(records);};function prepareData(data){var records={Possession:[],Cards:[],DuelsWonPercentage:[],Shots:[],PassAccuracyPercentage:[],Ratings:[]};var values=data.value;var possessionData=values[0];for(var i=0;i<possessionData.length;i++){var team=getTeam(possessionData[i]);team.Possession=possessionData[i][2];records.Possession.push(team);}var cardsData=values[1];for(var i=0;i<cardsData.length;i++){var team=getTeam(cardsData[i]);team.Red=cardsData[i][2];team.Yellow=cardsData[i][3];records.Cards.push(team);}var duelsData=values[2];if(!duelsData){return records;}for(var i=0;i<duelsData.length;i++){var team=getTeam(duelsData[i]);team.DuelsWonPercentage=duelsData[i][2];records.DuelsWonPercentage.push(team);}var shotsData=values[3];if(!shotsData){return records;}for(var i=0;i<shotsData.length;i++){var team=getTeam(shotsData[i]);team.Shots=shotsData[i][2];records.Shots.push(team);}var passData=values[4];if(!passData){return records;}for(var i=0;i<passData.length;i++){var team=getTeam(passData[i]);team.PassAccuracyPercentage=passData[i][2];records.PassAccuracyPercentage.push(team);}var ratingData=values[5];if(!ratingData){return records;}for(var i=0;i<ratingData.length;i++){var team=getTeam(ratingData[i]);team.Rating=ratingData[i][2].toFixed(2);records.Ratings.push(team);}return records;}function getTeam(teamData){return{TeamId:teamData[0],TeamName:teamData[1],TeamShortName:getShortDisplayName(teamData[1])};}function render(records){var html=[];html.push('<table class="ws-list-grid with-three-cols">');html.push("<tr>");html.push('<td class="col">');var possessionList=new WS.List({type:WS.ListType.BarWithPercentage,titles:["Possession"],view:{options:{displayFunction:function(team){return'<a title="'+team.TeamName+'" href="/Teams/'+team.TeamId+'" class="team-link">'+team.TeamName+"</a>";},width:$view.width()}},statTypes:["Possession"]});html.push(possessionList.getHtml(records.Possession));html.push("</td>");html.push('<td class="col">');var cardsList=new WS.List({titles:["Aggression","",""],view:{options:{displayFunction:function(team){return'<a title="'+team.TeamName+'" href="/Teams/'+team.TeamId+'" class="team-link">'+team.TeamName+"</a>";}}},statTypes:["Yellow","Red"],statTypeClasses:["yellow-card-box","red-card-box"]});html.push(cardsList.getHtml(records.Cards));html.push("</td>");html.push('<td class="col">');var duelsList=new WS.List({type:WS.ListType.BarWithPercentage,titles:["Aerial Duels Won"],view:{options:{displayFunction:function(team){return'<a title="'+team.TeamName+'" href="/Teams/'+team.TeamId+'" class="team-link">'+team.TeamName+"</a>";},width:$view.width()}},statTypes:["DuelsWonPercentage"]});html.push(duelsList.getHtml(records.DuelsWonPercentage));html.push("</td>");html.push("</tr>");html.push("<tr>");html.push('<td class="col">');var shotsList=new WS.List({type:WS.ListType.BarWithPercentage,titles:["Shots per Game"],view:{options:{displayFunction:function(team){return'<a title="'+team.TeamName+'" href="/Teams/'+team.TeamId+'" class="team-link">'+team.TeamName+"</a>";},width:$view.width(),barClass:"value"}},useValues:true,statTypes:["Shots"]});html.push(shotsList.getHtml(records.Shots));html.push("</td>");html.push('<td class="col">');var passList=new WS.List({type:WS.ListType.BarWithPercentage,titles:["Pass Accuracy"],view:{options:{displayFunction:function(team){return'<a title="'+team.TeamName+'" href="/Teams/'+team.TeamId+'" class="team-link">'+team.TeamName+"</a>";},width:$view.width()}},statTypes:["PassAccuracyPercentage"]});html.push(passList.getHtml(records.PassAccuracyPercentage));html.push("</td>");html.push('<td class="col">');var ratingsList=new WS.List({titles:["Ratings"],view:{options:{displayFunction:function(team){return'<a title="'+team.TeamName+'" href="/Teams/'+team.TeamId+'" class="team-link">'+team.TeamName+"</a>";}}},statTypes:["Rating"],statDisplayFunction:function(team){return'<span class="stat-value number rating">'+getRatingDisplayValue(team.Rating)+"</span>";}});html.push(ratingsList.getHtml(records.Ratings));html.push("</td>");html.push("</tr>");html.push("</table>");$view.html(html.join(""));}}WS.List=function(config){var id,$view,type,viewOptions,titles,statTypes,statTypeClasses,statDisplayFunction,footer,maxValues,useValues;init(config);function init(config){id=config.view.renderTo;$view=$("#"+id);type=config.type;viewOptions=config.view.options;titles=config.titles;statTypes=config.statTypes;statTypeClasses=config.statTypeClasses;statDisplayFunction=config.statDisplayFunction;footer=config.footer;useValues=config.useValues;maxValues={};}this.load=function(records){render(records);};this.getHtml=function(records){return view(records);};function emptyView(){if(viewOptions.errorFunction){viewOptions.errorFunction();return;}return'<tr><td colspan="99" style="color: #666; font-size: 0.9em;">N/A</td></tr>';}function view(records){if(!records){return"";}var html=[];html.push('<table class="ws-list'+(type?" list-type-"+type:"")+'">');html.push("<thead>");for(var i=0;i<titles.length;i++){html.push("<th "+(1==titles.length?'colspan="99" ':"")+'class="'+(0==i?"stat-title":"")+'">');html.push(titles[i]);html.push("</th>");}html.push("</thead>");html.push("<tbody>");if(0==records.length){html.push(emptyView());}else{for(var i=0;i<records.length;i++){html.push('<tr class="'+((1==i%2)?"alt":"")+'">');var listKey=viewOptions.displayFunction(records[i]);html.push('<td class="list-key">');html.push(listKey);html.push("</td>");if(statDisplayFunction){html.push("<td>");html.push(statDisplayFunction(records[i]));html.push("</td>");}else{for(var k=0;k<statTypes.length;k++){if(useValues&&!maxValues[statTypes[k]]){maxValues[statTypes[k]]=getMaxOfField(records,statTypes[k]);}html.push("<td>");html.push(getDisplayValue(records[i][statTypes[k]],k));html.push("</td>");}}html.push("</tr>");}}html.push("</tbody>");if(footer){html.push("<tfoot>");html.push("<tr>");html.push('<td colspan="99" class="'+(footer.clazz?footer.clazz:"")+'">');html.push(footer.text);html.push("</td>");html.push("</tr>");html.push("</tfoot>");}html.push("</table>");return html.join("");}function getDisplayValue(value,index){if(WS.ListType.BarWithPercentage==type){return getBarWithPercentageValue(value,index);}return'<span class="stat-value number '+getStatTypeClass(index)+'">'+value+"</span>";}function getStatTypeClass(index){if(!statTypeClasses){return"";}return statTypeClasses[index];}function getBarWithPercentageValue(value,index){var bar=[];var barWidth=(50*(viewOptions.width/(viewOptions.columns?viewOptions.columns:3))/100)-60;var valueWidth=value;if(useValues){valueWidth=getPercentage(value,maxValues[statTypes[index]]);}bar.push('<span style="width: '+barWidth+'px;" class="stat-bar-wrapper'+(viewOptions.barClass?" "+viewOptions.barClass+"":"")+'">');bar.push('<span style="width: '+valueWidth+'%;" class="stat-bar rc-r">');bar.push('<span class="stat-value">'+value+(!useValues?"%":"")+"</span>");bar.push("</span>");return bar.join("");}function render(records){$view.html(view(records));}};WS.ListType={Bar:1,BarWithPercentage:2,Value:3,ValueWithPercentage:4};function TeamPlayersTopListsPresenter(config){var id,$view;init(config);this.load=function(data){var records=prepareData(data);render(records,!data.params.isNotOpta);};this.id=function(){return id;};function selectTopListFromPlayers(players,criteria,topn,isValid){isValid=isValid||function(){return true;};var sorted=[];players.sort(function(a,b){return NG.sortNumeric(a[criteria],b[criteria])*(-1);});var selectN=Math.min(topn,players.length);var added=0,index=0;while(added<selectN&&index<players.length){if(isValid(players[index].GameStarted+players[index].SubOn)&&(0!=players[index][criteria])){sorted.push(players[index]);added++;}index++;}return sorted;}function render(records,isOpta){var html=[];html.push('<table class="ws-list-grid with-three-cols">');html.push("<tbody>");html.push("<tr>");var listConfig={view:{options:{displayFunction:function(player){return WS.PlayerLink(player.Id,getShortDisplayName(player.PlayerName));},errorFunction:function(){}}}};var listWithBarConfig=jQuery.extend(true,{},listConfig,{type:WS.ListType.BarWithPercentage,view:{options:{width:$view.width()}}});var listWithValueBarConfig=jQuery.extend(true,{},listWithBarConfig,{view:{options:{barClass:"value"}},useValues:true});html.push('<td class="col">');html.push(new WS.List(jQuery.extend({},listWithValueBarConfig,{titles:["Goals"],statTypes:["Goals"]})).getHtml(records.Goals));html.push("</td>");if(0!=records.Cards.length){html.push('<td class="col">');html.push(new WS.List(jQuery.extend({},listConfig,{titles:["Aggression","",""],statTypes:["Yellow","Red"],statTypeClasses:["yellow-card-box","red-card-box"]})).getHtml(records.Cards));html.push("</td>");}if(0!=records.Apps.length){html.push('<td class="col">');html.push(new WS.List(jQuery.extend({},listConfig,{titles:["Appearance"],statTypes:["Apps"],statDisplayFunction:function(player){return'<span class="stat-value number apps">'+player.GameStarted+(0!=player.SubOn?"("+player.SubOn+")":"")+"</span>";}})).getHtml(records.Apps));html.push("</td>");}html.push("</tr>");if(isOpta){html.push("<tr>");html.push('<td class="col">');html.push(new WS.List(jQuery.extend({},listWithValueBarConfig,{titles:["Aerials won"],statTypes:["AerialWon"]})).getHtml(records.Duels));html.push("</td>");html.push('<td class="col">');html.push(new WS.List(jQuery.extend({},listWithValueBarConfig,{titles:["Assists"],statTypes:["Assists"]})).getHtml(records.Assists));html.push("</td>");html.push('<td class="col">');html.push(new WS.List(jQuery.extend({},listWithBarConfig,{titles:["Ratings"],statTypes:["Rating"],statDisplayFunction:function(player){return'<span class="stat-value number rating">'+player.Rating+"</span>";}})).getHtml(records.Ratings));html.push("</td>");html.push("</tr>");}html.push("</tbody>");html.push("</table>");return $view.html(html.join(""));}function findMaxApps(players){var max=0;for(var k=0;k<players.length;k++){if(max<players[k].Apps){max=players[k].Apps;}}return max;}function prepareData(data){var topLists={Apps:[],Cards:[],Goals:[],Duels:[],Assists:[],Ratings:[]};var players=new PlayerStatsSummaryGridModel().load(data);var maxPlayerApp=findMaxApps(players);var thresholdFunc=function(app){return maxPlayerApp/5<=app;};topLists.Goals=selectTopListFromPlayers(players,"Goals",5,thresholdFunc);topLists.Apps=selectTopListFromPlayers(players,"GameStarted",5,thresholdFunc);topLists.Assists=selectTopListFromPlayers(players,"Assists",5,thresholdFunc);topLists.Ratings=selectTopListFromPlayers(players,"Rating",5,thresholdFunc);for(var i=0;i<players.length;i++){players[i].CardPoints=players[i].Yellow*1+players[i].Red*2.5;if("AGoalkeeper"==players[i].RealPosition){players[i].AerialWon=0;}}topLists.Cards=selectTopListFromPlayers(players,"CardPoints",5,thresholdFunc);topLists.Duels=selectTopListFromPlayers(players,"AerialWon",5,thresholdFunc);return topLists;}function init(config){id=config.view.renderTo;$view=$("#"+id);stageName=config.model.stageName;}}WS.Canvas=function(config){var view,model,pitch,stats;init(config);function init(config){view=config.view;type=config.model.type;if(view.is3D){var pitchAndMatrix=nextgame.statistics.draw3DPitch(nextgame.getContextById(view.renderTo+" .pitch-canvas"),view.width,view.height);var statsCtx=nextgame.getContextById(view.renderTo+" .stat-canvas");pitch=pitchAndMatrix.pitch;stats=new config.model.instanceType({context:statsCtx,pitch:pitch,matrix:pitchAndMatrix.matrix,maxBarHeight:pitchAndMatrix.maxBarHeight,type:type,extraOptions:config.extraOptions});$(statsCtx.canvas).attr(pitchAndMatrix.canvasDimensions);}else{var pitchAndStatsCtx=null;if(typeof(view.drawPitch)==="function"){pitchAndStatsCtx=view.drawPitch(view.renderTo);}else{pitchAndStatsCtx=nextgame.canvas.drawFullPitchAndCreateOverlayingStatsCanvas($("#"+view.renderTo),view.width,view.height);}pitch=pitchAndStatsCtx.pitch;stats=new config.model.instanceType({pitch:pitch,context:pitchAndStatsCtx.statsContext,width:view.width,height:view.height,type:type,extraOptions:config.extraOptions});}}this.load=function(data){stats.draw(data,config.view);};this.id=function(){return view.renderTo;};};function H2HTeamStatsSummaryInfoModel(data){var teamData=data.value[0];if(!teamData){return;}var record={played:teamData.GamesPlayed,data:[]};record.data[0]=NG.getAverage(teamData.Goals,teamData.GamesPlayed);record.data[1]=NG.getAverage(teamData.TotalShots,teamData.GamesPlayed);record.data[2]=NG.getAverage(teamData.Yellow,teamData.GamesPlayed);record.data[3]=NG.getAverage(teamData.Red,teamData.GamesPlayed);record.data[4]=NG.getAverage(teamData.Corners,teamData.GamesPlayed);record.data[5]=NG.getAverage(teamData.Fouls,teamData.GamesPlayed);record.data[6]=NG.getAverage(teamData.Offsides,teamData.GamesPlayed);record.data[7]=NG.getAverage(teamData.Throws,teamData.GamesPlayed);record.data[8]=NG.getPercentage(teamData.AerialWon,(teamData.AerialWon+teamData.AerialLost));record.data[9]=NG.getAverage(teamData.Possession,teamData.GamesPlayed);record.data[10]=NG.getPercentage(teamData.AccuratePasses,teamData.TotalPasses);record.data[11]=teamData.Rating;return record;}function H2HTeamStatsOffensiveInfoModel(data){var teamData=data.value[0];if(!teamData){return;}var record={played:teamData.GamesPlayed,data:[]};record.data[0]=NG.getAverage(teamData.Goals,teamData.GamesPlayed);record.data[1]=NG.getAverage(teamData.TotalShots,teamData.GamesPlayed);record.data[2]=NG.getAverage(teamData.ShotsOnTarget,teamData.GamesPlayed);record.data[3]=NG.getAverage(teamData.Dribbles,teamData.GamesPlayed);record.data[4]=NG.getAverage(teamData.WasFouled,teamData.GamesPlayed);record.data[5]=NG.getAverage(teamData.Dispossesed,teamData.GamesPlayed);record.data[6]=NG.getAverage(teamData.Offsides,teamData.GamesPlayed);record.data[7]=NG.getAverage(teamData.Throws,teamData.GamesPlayed);return record;}function H2HTeamStatsDefensiveInfoModel(data){var teamData=data.value[0];if(!teamData){return;}var record={played:teamData.GamesPlayed,data:[]};record.data[0]=NG.getAverage(teamData.TotalTackle,teamData.GamesPlayed);record.data[1]=NG.getAverage(teamData.Fouls,teamData.GamesPlayed);record.data[2]=getAsFloat(teamData.Interceptions,teamData.GamesPlayed);record.data[3]=getAsFloat(teamData.TotalClearance,teamData.GamesPlayed);record.data[4]=getAsFloat(teamData.ShotsBlocked,teamData.GamesPlayed);record.data[5]=getAsFloat((teamData.ShotsConcededIBox+teamData.ShotsConcededOBox),teamData.GamesPlayed);return record;}function LiveTeamStatsInfoModel(data){var record={data:[]};var stats=data[3][0];var totalPass=getStatValue(stats,"total_pass");var accuratePass=getStatValue(stats,"accurate_pass");var duelWon=getStatValue(stats,"aerial_won");var duelLost=getStatValue(stats,"aerial_lost");record.data[0]=getStatValue(stats,"total_offside");record.data[1]=getStatValue(stats,"fk_foul_lost");record.data[2]=getStatValue(stats,"won_corners");record.data[3]=getStatValue(stats,"total_throws");record.data[4]=getStatValue(stats,"won_contest");record.data[5]=getStatValue(stats,"total_tackle");record.data[6]=NG.getPercentage(accuratePass,totalPass);record.data[7]=NG.getPercentage(duelWon,(duelWon+duelLost));record.data[8]=getStatValue(stats,"possession_percentage");return record;}function LiveTeamStatsSummaryInfoModel(data){var record={data:[]};var stats=data[3][0];record.data[0]=getStatValue(stats,"total_scoring_att");record.data[1]=getStatValue(stats,"ontarget_scoring_att");var totalPass=getStatValue(stats,"total_pass");var accuratePass=getStatValue(stats,"accurate_pass");var duelWon=getStatValue(stats,"aerial_won");var duelLost=getStatValue(stats,"aerial_lost");record.data[2]=getAsFloat(100*accuratePass,totalPass);record.data[3]=getAsFloat(100*duelWon,(duelWon+duelLost));record.data[4]=getStatValue(stats,"won_contest");record.data[5]=getStatValue(stats,"total_tackle");record.data[6]=getStatValue(stats,"possession_percentage");return record;}function LiveTeamFormationPresenter(config){var $pitch,$lineup,$subs,$bench,$header,model,currentData={},selectedPlayers={};init(config);function init(config){$pitch=$(config.view.renderTo+"-content");$lineup=$(config.view.renderTo+"-content-lineup");$subs=$(config.view.renderTo+"-content-subs");$bench=$(config.view.renderTo+"-content-bench");$header=$(config.view.renderTo+"-header");model=config.model;}this.load=function(data){var teamFormation=prepareData(data);if(!teamFormation){return;}clear(teamFormation.field);render(teamFormation);setFormationLabel(teamFormation.formation,teamFormation.field);$(".player",$lineup).bind("click",selectPlayer);$(".player",$subs).bind("click",selectPlayer);$(".player",$bench).bind("click",selectPlayer);currentData[teamFormation.field]=teamFormation;var player;if(selectedPlayers[field]){player=selectedPlayers[field];}else{player=teamFormation.players[teamFormation.players.length-1];}if(!player){return;}selectPlayerByIdAndField(player.Id,teamFormation.field);};function ratingUpdateStatus(oldRating,newRating){var r1=NG.roundNumber(getRatingDisplayValue(oldRating),1),r2=NG.roundNumber(getRatingDisplayValue(newRating),1);return(r1<r2)?1:(r1==r2)?2:3;}function selectPlayer(){var playerId=$(this).attr("data-player-id");var field=$(this).attr("data-field");$(document).triggerHandler("live-player-clicked");selectPlayerByIdAndField(playerId,field);}function selectPlayerByIdAndField(playerId,field){var player=findPlayerByIdAndField(playerId,field);if(player){$(".player",$("."+field)).removeClass("selected");$('.player[data-player-id="'+playerId+'"]').addClass("selected");$(document).triggerHandler("live-player-selected-for-comparision",[player,field]);}selectedPlayers[field]=player;}function findPlayerByIdAndField(playerId,field){if(currentData[field]){var player;player=findPlayerById(currentData[field].players,playerId);if(!player){player=findPlayerById(currentData[field].subs,playerId);}if(!player){player=findPlayerById(currentData[field].bench,playerId);}return player;}return null;}function findPlayerById(players,playerId){if(players){for(var i=0;i<players.length;i++){if(playerId==players[i].Id){return players[i];}}}return null;}function setFormationLabel(formation,field){$("."+field+" .formation-label",$header).html(formation.split("").join("-"));}function clear(field){$(".team-pitch-formation."+field,$lineup).remove();$(".team-pitch-formation."+field,$subs).remove();$(".team-bench."+field,$bench).remove();}function prepareData(data){var teamFormation={};teamFormation.field=model.field;if(!data[4]||!data[5]){return;}players=data[4];var formation=data[5];teamFormation.rating=data[2];teamFormation.formation=formation[0];var formationPositions=formation[1];teamFormation.players=[];teamFormation.subs=[];teamFormation.bench=[];for(var i=1;i<12;i++){var playerData=getPlayerByFormationPlace(players,i);if(playerData){var formationPosition={vertical:formationPositions[i-1][0],horizontal:formationPositions[i-1][1]};var player=getPlayerRecord(playerData,formationPosition);teamFormation.players.push(player);}}var subs=getSubs(players);var nthSub=0;for(var i=0;i<subs.length;i++){var sub=getPlayerRecord(subs[i]);if(2==sub.SubstitutionType||(!sub.Position&&1==sub.SubstitutionType)){sub.Position={vertical:0,horizontal:nthSub};teamFormation.subs.push(sub);nthSub++;}else{teamFormation.bench.push(sub);}}teamFormation.subs.sort(function(a,b){return b.Name<a.Name;});teamFormation.bench.sort(function(a,b){return b.Name<a.Name;});return teamFormation;}function getPlayerRecord(playerData,formationPosition){var player={Id:playerData[0],Name:playerData[1],PositionText:playerData[5],Position:formationPosition,Rating:NG.roundNumber(playerData[2],1),ShirtNo:playerData[6]?playerData[6]:"",SubstitutionType:playerData[7],SubstitutionMinute:playerData[8],PlayedPositions:playerData[9],Age:playerData[10],Height:playerData[11],Weight:playerData[12],Stats:new LivePlayerStatModel(playerData)};loadLivePlayerStatisticsEvents(playerData[3][0],player);setIsManOfTheMatch(playerData[3][0],player);return player;}function getPlayerByFormationPlace(players,formationPlace){for(var i=0;i<players.length;i++){if(formationPlace==getStatValue(players[i][3][0],"formation_place")){return players[i];}}return null;}function getSubs(players){var subs=[];for(var i=0;i<players.length;i++){if(0==getStatValue(players[i][3][0],"formation_place")){subs.push(players[i]);}}return subs;}function render(teamFormation){var html=[];var subsHtml=[];var benchHtml=[];var players=teamFormation.players,subs=teamFormation.subs,bench=teamFormation.bench;var pitchDimensions=getPitchDimensions();var cellWidth=(pitchDimensions.width/2)/11,cellHeight=pitchDimensions.height/11,marginFrom="home"==teamFormation.field?"left":"right";var viewDimensions={cellWidth:cellWidth,cellHeight:cellHeight,marginFrom:marginFrom,pitchDimensions:pitchDimensions,playerHeight:60,playerWidth:16};html.push('<div class="team-pitch-formation '+teamFormation.field+'">');var oldTeamRating;if(currentData[teamFormation.field]){oldTeamRating=currentData[teamFormation.field].rating;}html.push('<div class="team-rating rating-status-{1}"><span class="rating rc">{0}</span></div>'.format(teamFormation.rating.toFixed(2),oldTeamRating?ratingUpdateStatus(oldTeamRating,teamFormation.rating):0));for(var i=0;i<players.length;i++){html.push(getPlayerHtml(players[i],viewDimensions,teamFormation.field));}html.push("</div>");subsHtml.push('<div class="team-pitch-formation '+teamFormation.field+'">');for(var i=0;i<subs.length;i++){subsHtml.push(getPlayerHtml(subs[i],viewDimensions,teamFormation.field,true));}subsHtml.push("</div>");benchHtml.push('<div class="team-bench '+teamFormation.field+'">');for(var i=0;i<bench.length;i++){benchHtml.push(getBenchPlayerHtml(bench[i],teamFormation.field));}benchHtml.push("</div>");$lineup.append(html.join(""));$subs.append(subsHtml.join(""));$bench.append(benchHtml.join(""));}function getBenchPlayerHtml(player,field){var b=[];b.push('<span class="player" data-field="{0}" data-player-id="{1}">'.format(field,player.Id));b.push('<span class="name rc">{0}.{1}</span>'.format(player.ShirtNo,getLastName(player.Name)));b.push("</span>");return b.join("");}function getPlayerHtml(player,viewDimensions,field,isSub){var oldPlayer=findPlayerByIdAndField(player.Id,field);var vertical=isSub?-15:(player.Position.vertical*viewDimensions.cellHeight)+(viewDimensions.cellHeight-viewDimensions.playerHeight)/2;var horizontal=isSub?0==player.Position.horizontal?30:player.Position.horizontal*100:(player.Position.horizontal*viewDimensions.cellWidth)-15;var html=[];html.push('<table data-player-id="'+player.Id+'" data-field="'+field+'"');html.push(' title="'+player.ShirtNo+" "+player.Name+" ("+player.PositionText+") - "+player.Rating+'" ');html.push('style="top: '+vertical+"px; "+viewDimensions.marginFrom+": "+horizontal+'px;" class="player has-stats'+(isSub?" sub":""));html.push(" rating-status-"+(oldPlayer?ratingUpdateStatus(oldPlayer.Rating,player.Rating):0));html.push('">');html.push("<tr>");html.push('<td class="live-player-events">');if(player.SubstitutionType){html.push('<span class="incident-wrapper pulsable">');html.push(getSubstitutionHtml(player.SubstitutionType,player.SubstitutionMinute));html.push("</span>");}if("Sub"==player.PositionText&&1==player.SubstitutionType){html.push('<span class="incident-wrapper pulsable">');html.push(getSubstitutionHtml(2));html.push("</span>");}html.push(getPlayerEventsHtml(player.events,oldPlayer?oldPlayer.Events:null));if(player.IsManOfTheMatch){html.push('<span class="incident-wrapper pulsable"><span title="Man of the Match" class="incidents-icon ui-icon mom"></span></span>');}html.push("</td>");html.push("</tr>");html.push("<tr>");html.push("<td>");html.push('<span class="name rc">{0}.{1}</span>'.format(player.ShirtNo,getLastName(player.Name)));html.push("</td>");html.push("</tr>");html.push('<tr><td class="stat-value pulsable rating">{0}</td></tr>'.format(player.Rating.toFixed(1)));html.push("</table>");return html.join("");}function getPitchDimensions(){if(!$lineup){return;}return{width:$lineup.width(),height:356};}}function getPlayerEventsHtml(events,oldEvents){var html=[];for(var event in events){var eventChanged=oldEvents?oldEvents[event]?(oldEvents[event].v<events[event].v):true:true;for(var k=0;k<events[event].v;k++){html.push('<span class="incident-wrapper {0}"><span title="'.format(eventChanged?"pulsable":"")+getIncidentToolTip(events[event].d)+'" class="incidents-icon ui-icon '+events[event].d+'"></span></span>');}}return html.join("");}function LiveTeamShotsModel(data){if(!data){return null;}var stats=data[3][0];return{TeamId:data[0],TeamName:data[1],Goals:getStatValue(stats,"goals"),TotalShots:getStatValue(stats,"total_scoring_att"),ShotsOnTarget:getStatValue(stats,"ontarget_scoring_att"),ShotsOffTarget:getStatValue(stats,"shot_off_target"),ShotsOnPost:getStatValue(stats,"post_scoring_att"),ShotsBlocked:getStatValue(stats,"blocked_scoring_att"),Miss:{HighLeft:getStatValue(stats,"att_miss_high_left"),HighCentre:getStatValue(stats,"att_miss_high"),HighRight:getStatValue(stats,"att_miss_high_right"),Left:getStatValue(stats,"att_miss_left"),Right:getStatValue(stats,"att_miss_right")},Goal:{HighLeft:getStatValue(stats,"att_goal_high_left"),HighCentre:getStatValue(stats,"att_goal_high_centre"),HighRight:getStatValue(stats,"att_goal_high_right"),LowLeft:getStatValue(stats,"att_goal_low_left"),LowCentre:getStatValue(stats,"att_goal_low_centre"),LowRight:getStatValue(stats,"att_goal_low_right")},Post:{Centre:getStatValue(stats,"att_post_high"),Left:getStatValue(stats,"att_post_left"),Right:getStatValue(stats,"att_post_right")},Save:{HighLeft:getStatValue(stats,"att_sv_high_left"),HighCentre:getStatValue(stats,"att_sv_high_centre"),HighRight:getStatValue(stats,"att_sv_high_right"),LowLeft:getStatValue(stats,"att_sv_low_left"),LowCentre:getStatValue(stats,"att_sv_low_centre"),LowRight:getStatValue(stats,"att_sv_low_right")}};}function LiveTeamShots(config){var $stats,$zoneChart,currentModel;init();function init(){$stats=$(config.view.renderTo+" .content");$zoneChart=$(config.view.renderTo+" .shot-zone-chart");}this.load=function(data){var shotsModel=new LiveTeamShotsModel(data);$stats.html(LiveTeamShotsView(shotsModel,currentModel)).fadeIn();$zoneChart.html(LiveTeamShotsZoneChartView(shotsModel,currentModel));$("li",$stats).hover(function(){var $this=$(this);var type=$this.attr("data-type");if(type){if("all"==type){$(".shot-zone",$zoneChart).addClass("highlight");}else{$('.shot-zone[data-type="{0}"]'.format(type),$zoneChart).addClass("highlight");}}},function(){$(".shot-zone",$zoneChart).removeClass("highlight");});currentModel=shotsModel;};}function LiveTeamShotsZoneChartView(model,oldModel){var t=[];function addStatView(clazz,shots,goals,sumOfOldValues){var type=clazz.split("-")[0];goals=goals||0;sumOfOldValues=sumOfOldValues||0;if(0!=(shots+goals)){var goalsHtml="";if(0!=goals){goalsHtml='<span class="incidents-icon ui-icon goal"><span class="number box-shadow">{0}</span></span>'.format(goals);}var shotsHtml=0!=shots?'<span class="miss">{0}</span>'.format(shots):"";var title=0!=shots?"Misses: {0}".format(shots):"";title+=0!=shots&&0!=goals?",":"";title+=0!=goals?"Goals: {0}".format(goals):"";t.push('<span title="{5}" class="shot-zone rc {3} {0} {4}" data-type="{6}">{1}{2}</span>'.format(clazz,shotsHtml,goalsHtml,(sumOfOldValues<shots+goals)?"incident-wrapper pulsable":"",0!=goals?"has-goals":"",title,type));}}if(model){addStatView("miss-high-left",model.Miss.HighLeft,null,oldModel?oldModel.Miss.HighLeft:null);addStatView("miss-high-centre",model.Miss.HighCentre,null,oldModel?oldModel.Miss.HighCentre:null);addStatView("miss-high-right",model.Miss.HighRight,null,oldModel?oldModel.Miss.HighRight:null);addStatView("miss-left",model.Miss.Left,null,oldModel?oldModel.Miss.Left:null);addStatView("miss-right",model.Miss.Right,null,oldModel?oldModel.Miss.Right:null);addStatView("post-left",model.Post.Left,null,oldModel?oldModel.Post.Left:null);addStatView("post-centre",model.Post.Centre,null,oldModel?oldModel.Post.Centre:null);addStatView("post-right",model.Post.Right,null,oldModel?oldModel.Post.Right:null);addStatView("ontarget-high-left",model.Save.HighLeft,model.Goal.HighLeft,oldModel?(oldModel.Save.HighLeft+oldModel.Goal.HighLeft):null);addStatView("ontarget-high-centre",model.Save.HighCentre,model.Goal.HighCentre,oldModel?(oldModel.Save.HighCentre+oldModel.Goal.HighCentre):null);addStatView("ontarget-high-right",model.Save.HighRight,model.Goal.HighRight,oldModel?(oldModel.Save.HighRight+oldModel.Goal.HighRight):null);addStatView("ontarget-low-left",model.Save.LowLeft,model.Goal.LowLeft,oldModel?(oldModel.Save.LowLeft+oldModel.Goal.LowLeft):null);addStatView("ontarget-low-centre",model.Save.LowCentre,model.Goal.LowCentre,oldModel?(oldModel.Save.LowCentre+oldModel.Goal.LowCentre):null);addStatView("ontarget-low-right",model.Save.LowRight,model.Goal.LowRight,oldModel?(oldModel.Save.LowRight+oldModel.Goal.LowRight):null);}return t.join("");}function statChanged(value,oldValue){return oldValue?oldValue<value:true;}function LiveTeamShotsView(model,oldModel){oldModel=oldModel||{};var t=[];if(model){t.push("<ul>");t.push('<li class="alt"><label>Total Shots: </label><span class="{1}">{0}</span></li>'.format(model.TotalShots,statChanged(model.TotalShots,oldModel.TotalShots)?"pulsable":""));t.push('<li data-type="ontarget" class="hoverable"><label>On Target: </label><span class="{1}">{0}</span></li>'.format(model.ShotsOnTarget,statChanged(model.TotalShots,oldModel.TotalShots)?"pulsable":""));t.push('<li  data-type="miss" class="hoverable alt"><label>Off Target: </label><span class="{1}">{0}</span></li>'.format(model.ShotsOffTarget,statChanged(model.TotalShots,oldModel.TotalShots)?"pulsable":""));t.push('<li  data-type="post" class="hoverable"><label>Hit Woodwork: </label><span class="{1}">{0}</span></li>'.format(model.ShotsOnPost,statChanged(model.TotalShots,oldModel.TotalShots)?"pulsable":""));t.push('<li class="alt"><label>Blocked: </label><span class="{1}">{0}</span></li>'.format(model.ShotsBlocked,statChanged(model.TotalShots,oldModel.TotalShots)?"pulsable":""));t.push("</ul>");}return t.join("");}function LivePlayerStatsComparisionBox(config){var $view,$homeProfile,$awayProfile,players,currentStats;init();function init(){$view=$(config.view.renderTo);$homeProfile=$(".live-player-profile.home");$awayProfile=$(".live-player-profile.away");field=config.field;players={home:null,away:null};bindEvents();}function bindEvents(){$(document).bind("live-player-selected-for-comparision",function(e,player,field){players[field]=player;renderPlayerComparision();});}function renderPlayerComparision(){if(players.home&&players.away){var groupedByStatType=groupStatsByType();renderStats(groupedByStatType);currentStats=groupedByStatType;updatePlayerNames();updatePlayerProfile();updatePlayerAvatars();}}function updatePlayerNames(){$(".player-name",$homeProfile).html(WS.PlayerLink(players.home.Id,"{0}. {1}".format(players.home.ShirtNo,players.home.Name)));$(".player-name",$awayProfile).html(WS.PlayerLink(players.away.Id,"{0}. {1}".format(players.away.ShirtNo,players.away.Name)));}function updatePlayerProfile(){$(".content",$homeProfile).html(getPlayerProfileHtml(players.home));$(".content",$awayProfile).html(getPlayerProfileHtml(players.away));}function getPlayerProfileHtml(player){var t=[];if(player){t.push("<ul>");t.push('<li class="played-positions alt"><label>Current Position:</label> {0}</li>'.format(player.PositionText));t.push('<li class="played-positions"><label>Playable Positions:</label> {0}</li>'.format(player.PlayedPositions));if(player.Age){t.push('<li class="player-age alt"><label>Age: </label>{0}</li>'.format(player.Age));}if(player.Height){t.push('<li class="player-height"><label>Height: </label>{0}cm</li>'.format(player.Height));}if(player.Weight){t.push('<li class="player-weight alt"><label>Weight: </label>{0}kg</li>'.format(player.Weight));}t.push("</ul>");}return t.join("");}function updatePlayerAvatars(){$(".player-picture",$homeProfile).attr("src",gImageUrl+"players/"+players.home.Id+".jpg");$(".player-picture",$awayProfile).attr("src",gImageUrl+"players/"+players.away.Id+".jpg");}function renderStatValue(groupedByStatType,stat,field){var value=!isNaN(groupedByStatType[stat][field])?parseFloat(groupedByStatType[stat][field]):groupedByStatType[stat][field];var otherField="home"==field?"away":"home";var otherValue=!isNaN(groupedByStatType[stat][otherField])?parseFloat(groupedByStatType[stat][otherField]):groupedByStatType[stat][otherField];var oldValue=currentStats?(currentStats[stat]?currentStats[stat][field]:0):0;oldValue=!isNaN(oldValue)?parseFloat(oldValue):oldValue;return'<span class="{1} {2}">{0}</span>'.format(displayValue(value,groupedByStatType[stat].IsPercentage),isGreaterThan(value,otherValue)?"greater":"",statChanged(value,oldValue)?"pulsable":"");}function renderStats(groupedByStatType){var html=[];html.push('<div id="live-summary-player-comparision-events" class="two-cols">');html.push('<span class="home">');html.push(getPlayerEventsHtml(players.home.events));if(players.home.IsManOfTheMatch){html.push('<span class="incident-wrapper pulsable"><span class="incidents-icon ui-icon mom" title="Man of the Match"></span></span>');}html.push("</span>");html.push('<span class="away">');html.push(getPlayerEventsHtml(players.away.events));if(players.away.IsManOfTheMatch){html.push('<span class="incident-wrapper pulsable"><span class="incidents-icon ui-icon mom" title="Man of the Match"></span></span>');}html.push("</span>");html.push("</div>");var i=0;for(var stat in groupedByStatType){html.push('<div class="stat {0}">'.format(0==i%2?"alt":""));html.push('<span class="stat-value" style="width: 60px;">');html.push(renderStatValue(groupedByStatType,stat,"home"));html.push("</span>");html.push('<span style="width: 80px;" class="stat-label">'+stat+"</span>");html.push('<span class="stat-value" style="width: 60px;">');html.push(renderStatValue(groupedByStatType,stat,"away"));html.push("</span>");html.push("</div>");i++;}$view.html(html.join(""));}function IsNumeric(input){var RE=/^-{0,1}\d*\.{0,1}\d+$/;return(RE.test(input));}function isGreaterThan(value,opponentValue){if(!(IsNumeric(value)&&IsNumeric(opponentValue))){return false;}return opponentValue<value;}function displayValue(value,isPercentage){if(!value){return"-";}return value+(isPercentage?"%":"");}function groupStatsByType(){var grouped={};groupStatByTypeForField(grouped,"home");groupStatByTypeForField(grouped,"away");return grouped;}function groupStatByTypeForField(group,field){var player=players[field];if(!player){return;}for(var i=0;i<player.Stats.length;i++){ensureStatTypeExistsInGroup(group,player.Stats[i].DisplayName);group[player.Stats[i].DisplayName][field]=player.Stats[i].Value;group[player.Stats[i].DisplayName].IsPercentage=player.Stats[i].IsPercentage;}}function ensureStatTypeExistsInGroup(group,type){if(!group[type]){group[type]={};}}}function LivePlayerModel(playerData){return{Id:playerData[0],Name:playerData[1],Rating:NG.roundNumber(playerData[2],1),Stats:new LivePlayerStatModel(playerData),Position:playerData[4],PositionText:playerData[5],ShirtNo:playerData[6],SubstitutionType:playerData[7],SubstitutionMinute:playerData[8],FormationPlace:getStatValue(playerData[3][0],"formation_place"),IsManOfTheMatch:_gIsMotmVisible?getStatValue(playerData[3][0],"man_of_the_match"):0,IsSub:5==playerData[4]};}function LivePlayerStatModel(data){var records=[];var position=data[4];var detailedPosition=data[5];var stats=data[3][0];var totalPass=getStatValue(stats,"total_pass");var accuratePass=getStatValue(stats,"accurate_pass");var duelWon=getStatValue(stats,"aerial_won");var duelLost=getStatValue(stats,"aerial_lost");records[0]={DisplayName:"Pass Accuracy",Value:getPercentage(accuratePass,totalPass),IsPercentage:true};records[1]={DisplayName:"Aerials Won",Value:getPercentage(duelWon,(duelWon+duelLost)),IsPercentage:true};records[2]={DisplayName:"Touches",Value:getStatValue(stats,"touches")};records[3]={DisplayName:"Fouls",Value:getStatValue(stats,"fouls")};if(1==position){records[4]={DisplayName:"Saves",Value:getStatValue(stats,"saves")};records[5]={DisplayName:"One on One",Value:getStatValue(stats,"total_one_on_one")};var goodHighClaim=getStatValue(stats,"good_high_claim");var goodClaim=getStatValue(stats,"good_claim");records[6]={DisplayName:"Cross Claims",Value:goodHighClaim+goodClaim};}else{records[4]={DisplayName:"Total Shots",Value:getStatValue(stats,"total_scoring_att")};records[5]={DisplayName:"Dribbles Won",Value:getStatValue(stats,"won_contest")};records[6]={DisplayName:"Tackles",Value:getStatValue(stats,"total_tackle")};}records[7]={DisplayName:"Rating",Value:NG.roundNumber(data[2],1)};return records;}function getRatingDisplayValue(rating,precision){precision=precision||2;if(!rating){return 0;}return NG.roundNumber(rating,precision);}function setIsManOfTheMatch(stats,player){if(0!=getStatValue(stats,"man_of_the_match")&&_gIsMotmVisible){player.IsManOfTheMatch=true;}}function getShortDisplayName(name,hideTitle){name=jQuery.trim(name);var names=name.split(" ");if(names.length==1){return name;}var result=[];for(var i=0;i<names.length-1;i++){result.push(names[i].charAt(0)+". ");}result.push(names[names.length-1]);return"<span "+(!hideTitle?('title="'+name+'"'):"")+">"+result.join("")+"</span>";}function getLastName(name){var names=name.trim().split(" ");return'<span title="'+name+'">'+names[names.length-1]+"</span>";}function getSubstitutionHtml(substitutionType,minute){if(0==substitutionType){return"";}var substitutionIcon=1==substitutionType?"subst-out":"subst-in";var min=(minute?minute+"'":"");if(minute&&0==minute){min="";}return'<span title="'+min+'" class="substitution-minute"><span class="incidents-icon ui-icon '+substitutionIcon+'"></span></span>';}WS.Stats.ZeroFixer=function(){$(document).bind("fix-zeros",function(event,$element){$element.each(function(){if(0==$(this).html()){$(this).html("-");}});});}();WS.Stats.PieChartComparision=function(config){var id,$view,$homePie,$awayPie,$comparision,model,view,fields,pies,selectedCategoryIndex,fixedInfo;init(config);this.load=function(data){var homeRecords=model.instanceType(data.home);var awayRecords=model.instanceType(data.away);loadCurrentFields(data,"home");loadCurrentFields(data,"away");if(model.perGame){makePerGame(homeRecords,"home");makePerGame(awayRecords,"away");}clearView();renderPart("home");renderComparision();renderPart("away");$homePie=$("#"+id+"-home");$awayPie=$("#"+id+"-away");$comparision=$("#"+id+"-comparision");loadPie(homeRecords,"home");loadComparision(homeRecords,awayRecords);loadPie(awayRecords,"away");$view.triggerHandler("model-updated");selectCategory(selectedCategoryIndex);};this.id=function(){return id;};function loadCurrentFields(data,field){if(!data[field].contentFilter){return;}fields[field]=data[field].contentFilter.field;}function init(config){id=config.view.renderTo;$view=$("#"+id);model=config.model;view=config.view;fields={};pies={};selectedCategoryIndex=1;fixedInfo=model.fixedInfo;bindEvents();}function getCategoryIdentifier(index){return{clicked:{index:model.identifiers.index,value:model.identifiers.value[index]}};}function makePerGame(records,field){for(var i=0;i<records.length;i++){records[i]=parseInt(records[i]/model[field].played[fields[field]]);}}function bindEvents(){$view.on("click",".stat",function(){var index=$(this).index();updatePieChartFilters(index-2);selectCategory(index);});}function selectCategory(index){selectCategoryInView(index-1);selectedCategoryIndex=index;updateInfo(index);}function updateInfo(index){if(!fixedInfo){if(1==index){$view.triggerHandler("clicked");}else{$view.triggerHandler("clicked",[getCategoryIdentifier(index-2)]);}}if(model.titles){$view.triggerHandler("info-title-updated",[model.titles[index-1]]);}}function selectCategoryInView(index){$(".stat",$view).removeClass("selected").css("background","none");$(".stat:eq("+index+")",$comparision).addClass("selected");if(0==index){$(".stat:eq("+index+")",$comparision).css("background-color","#A2BE67");}else{$(".stat:eq("+index+")",$comparision).css("background-color",model.categories[index-1].color);}}function clearView(){$view.html("");}function getIdentifierIndex(identifier){if(!model.identifiers){return;}for(var i=0;i<model.identifiers.value.length;i++){if(model.identifiers.value[i]==identifier.clicked.value){return i;}}}function updatePieChartFilters(index){pies.home.updateFilter(index);pies.away.updateFilter(index);}function renderPart(field){$view.append('<div id="'+id+"-"+field+'" class="'+field+'"></div>');$("#"+id+"-"+field,$view).width(view.pie.width);$("#"+id+"-"+field,$view).bind("clicked",function(options,categoryIdentifier){selectCategory(categoryIdentifier.clicked.id+2);updatePieChartFilters(categoryIdentifier.clicked.id);});}function getTitle(field,isEmptyData){var title=[];title.push("<ul>");title.push("<li>");if("home"==field){title.push(WS.TeamEmblemUrl(model[field].teamId,model[field].name,"height: 2em; width: 2em; vertical-align: middle;"));}title.push('<span style="margin-left: 0.4em;">'+model[field].name+"</span>");if("away"==field){title.push(WS.TeamEmblemUrl(model[field].teamId,model[field].name,"height: 2em; width: 2em; vertical-align: middle;"));}title.push("</li>");if(fields[field]){title.push('<li style="font-size: 0.7em;">');title.push("Played: "+model[field].played[fields[field]]);title.push("</li>");}if(isEmptyData){title.push('<li style="font-size: 0.7em; margin-top: 4em;">');title.push(view.emptyDataMessage?view.emptyDataMessage:"N/A");title.push("</li>");}title.push("</ul>");return title.join("");}function dataIsEmpty(data){if(!data){return true;}if(0==data.sum()){return true;}}function loadPie(data,field){var pieView=$.extend(true,{renderTo:id+"-"+field,title:getTitle(field,dataIsEmpty(data))},view.pie);var pie=new WS.Stats.PieChart({model:model,view:pieView});pie.load(data);pies[field]=pie;}function renderComparision(){$view.append('<div id="'+id+'-comparision" class="stat-info"></div>');}function loadComparision(home,away){var comparision=new WS.Stats.Info({view:{renderTo:id+"-comparision",width:200,labelWidth:80},model:{instanceType:PieChartComparisionModel,labelGroups:[{start:0,end:5,hideBars:true,title:model.comparision.title}],labels:getLabels()}});comparision.load({home:home,away:away});$(document).triggerHandler("fix-zeros",[$(".stat-value",$comparision)]);}function getLabels(){var labels=[];labels.push({type:"value",displayValue:"Total"});for(var i=0;i<model.categories.length;i++){labels.push({type:"value",displayValue:model.categories[i].displayName});}return labels;}};function PieChartComparisionModel(data){if(!data||0==data.length){return;}var records=[];records[0]=data.sum();for(var i=0;i<data.length;i++){records[i+1]=data[i];}return{data:records};}var StageTouchChannelsGridDefaults=$.extend({},gridDefaults,{model:{type:StageTouchChannelsGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"Left",direction:"desc"}}});var StageAttemptDirectionsGridDefaults=$.extend({},gridDefaults,{model:{type:StageAttemptDirectionsGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"Left",direction:"desc"}}});var StageAttemptZonesGridDefaults=$.extend({},gridDefaults,{model:{type:StageAttemptZonesGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"Isb",direction:"desc"}}});var StageTouchZonesGridDefaults=$.extend({},gridDefaults,{model:{type:StageTouchZonesGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"Def",direction:"desc"}}});var StageGoalsGridDefaults=$.extend({},gridDefaults,{model:{type:StageGoalsGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"Op",direction:"desc"}}});var StagePassesGridDefaults=$.extend({},gridDefaults,{model:{type:StagePassesGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"Sp",direction:"desc"}}});var StageCardsGridDefaults=$.extend({},gridDefaults,{model:{type:StageCardsGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"F",direction:"desc"}}});var StageTeamStatsSummaryGridDefaults=$.extend({},gridDefaults,{model:{type:TeamStatsSummaryGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var StageTeamStatsOffensiveGridDefaults=$.extend({},gridDefaults,{model:{type:TeamStatsOffensiveGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"TotalShots",direction:"desc"}}});var StageTeamStatsDefensiveGridDefaults=$.extend({},gridDefaults,{model:{type:TeamStatsDefensiveGridModel,cache:true},view:StageTeamStatsGridView,sorter:{sortInfo:{property:"TotalTackle",direction:"desc"}}});function StageTeamStatsGridView(records){function getMaxStat(teams,maxes,f){if(maxes[f]){return maxes[f];}var max=0;for(var j=0;j<teams.length;j++){if(teams[i][f]){if(max<teams[j][f]){max=teams[j][f];}}}maxes[f]=max;return max;}var teams=records.model.records;var exclude={StatsAndHoverValues:1,TeamId:1,TeamName:1,RegionId:1,RegionCode:1,TournamentId:1,TournamentName:1,WRating:1,Yellow:1,Red:1,Ranking:1};var useBar={Ads:1,Bp:1,Ps:1,Ds:1,Left:1,Centre:1,Right:1,Ib:1,Ob:1,Isb:1,Def:1,Mid:1,Att:1};var maxes={};var t=[];for(var i=0;i<teams.length;i++){var o=teams[i];t.push("<tr "+((1==i%2)?'class="alt"':"")+">");t.push('<td class="o">'+(i+1)+"</td>");t.push('<td class="tn"><a href="/Teams/'+o.TeamId+'" class="team-link">'+o.TeamName+"</a></td>");for(var f in o){if(!exclude[f]){if("CardPoints"==f){t.push('<td class="agg">');t.push('<span class="yellow-card-box">'+o.Yellow+"</span>");t.push('<span class="red-card-box">'+o.Red+"</span>");t.push("</td>");}else{if(useBar[f]){var maxStat=getMaxStat(teams,maxes,f);t.push("<td>"+statBar(50,o[f],getPercentage(o[f],maxStat))+"</td>");}else{if("Ar"==f){t.push('<td><span class="stat-value number rating">'+NG.roundNumber(o.Ar,2)+"</span></td>");}else{t.push('<td title="{0}" class="{1}">{2}</td>'.format(o.StatsAndHoverValues?o.StatsAndHoverValues[f]:"",f.toLowerCase(),o[f]));}}}}}t.push("</tr>");}return t.join("");}function statBar(width,value,percentage,clazz){return'<span class="stat-bar-wrapper '+(clazz?clazz:"")+'" style="width: '+width+'px;"><span class="stat-bar rc-r" style="width: '+percentage+'%;"><span class="stat-value">'+value+"%</span></span></span>";}function StageCardsGridModel(){this.load=function(data){if(!data){return[];}var records=[];var teams=data.value[0];for(var i=0;i<teams.length;i++){var stats=[0,0,0,0];AggresionModel(stats,teams[i][2][0][0]);records.push({TeamId:teams[i][0],TeamName:teams[i][1],F:stats[0],U:stats[1],D:stats[2],Ot:stats[3]});}return records;};}function getPlayedForTeam(teamsPlayed,teamId,field){for(var i=0;i<teamsPlayed.length;i++){if(teamId==teamsPlayed[i][0]){return eval(teamsPlayed[i][2][0])[field];}}return 1;}function StagePassesGridModel(){this.load=function(data){if(!data){return[];}var records=[];var teams=data.value[0];var teamsPlayed=DataStore.load("ws-teams-stage-stat",{parameters:{stageId:data.params.defaultParams.stageId,type:25,teamId:-1,field:-1,against:-1},cache:true,dataType:"array"});var field=parseInt(data.filter.data.field);for(var i=0;i<teams.length;i++){var team={TeamId:teams[i][0],TeamName:teams[i][1]};var stats=[0,0,0,0,0];var passes=teams[i][2][0][1];for(var j=0;j<passes.length;j++){PassTypesModel(stats,passes[j]);}var played=getPlayedForTeam(teamsPlayed[0],team.TeamId,field);team.Cr=Math.round(stats[0]/played);team.Tb=Math.round(stats[1]/played);team.Lb=Math.round(stats[2]/played);team.Sp=Math.round(stats[3]/played);records.push(team);}return records;};}function StageGoalsGridModel(){this.load=function(data){if(!data){return[];}var records=[];var teams=data.value[0];for(var i=0;i<teams.length;i++){var team={TeamId:teams[i][0],TeamName:teams[i][1]};var stats=[0,0,0,0,0];var contentFilter={goal:{index:0,value:"goal"}};var attempts=teams[i][2][0][0];for(var j=0;j<attempts.length;j++){GoalTypesModel(stats,attempts[j],contentFilter);}team.Op=stats[0];team.Fb=stats[2];team.Sp=stats[1];team.Pen=stats[3];team.Og=stats[4];records.push(team);}return records;};}function TouchZonesGridModel(stats){if(!stats){return null;}var record={forStats:{},againstStats:{}};record.forStats.defense=NG.roundNumber(100*stats[0]/NG.roundNumber(stats.sum()));record.forStats.midfield=NG.roundNumber(100*stats[1]/NG.roundNumber(stats.sum()));record.forStats.attack=NG.roundNumber(100*stats[2]/NG.roundNumber(stats.sum()));record.againstStats.defense=NG.roundNumber(100*stats[3]/NG.roundNumber(stats.sum()));record.againstStats.midfield=NG.roundNumber(100*stats[4]/NG.roundNumber(stats.sum()));record.againstStats.attack=NG.roundNumber(100*stats[5]/NG.roundNumber(stats.sum()));return record;}function StageTouchZonesGridModel(){this.load=function(data){if(!data){return[];}var records=[];var values=data.value[0];for(var i=0;i<values.length;i++){var stats=values[i][2][0];if(stats){var record=TouchZonesGridModel(stats);records.push({TeamId:values[i][0],TeamName:values[i][1],Def:record.forStats.defense+record.againstStats.attack,Mid:record.forStats.midfield+record.againstStats.midfield,Att:record.forStats.attack+record.againstStats.defense});}}return records;};}function StageTouchChannelsGridModel(){this.load=function(data){if(!data){return[];}var records=[];var values=data.value[0];for(var i=0;i<values.length;i++){var stats=values[i][2][0];var sum=stats.sum();records.push({TeamId:values[i][0],TeamName:values[i][1],Left:stats?getPercentage(stats[0],sum):0,Centre:stats?getPercentage(stats[1],sum):0,Right:stats?getPercentage(stats[2],sum):0});}return records;};}function getPercentage(value,total){if(!value||!total){return 0;}if(0==total){return 0;}return Math.round(100*value/total);}function StageAttemptDirectionsGridModel(){this.load=function(data){if(!data){return[];}var records=[];var values=data.value[0];for(var i=0;i<values.length;i++){var stats=values[i][2][0];var sum=stats.sum();records.push({TeamId:values[i][0],TeamName:values[i][1],Left:stats?getPercentage(stats[0],sum):0,Centre:stats?getPercentage(stats[1],sum):0,Right:stats?getPercentage(stats[2],sum):0});}return records;};}function StageAttemptZonesGridModel(){this.load=function(data){if(!data){return[];}var records=[];var values=data.value[0];for(var i=0;i<values.length;i++){var stats=values[i][2][0];var sum=stats.sum();records.push({TeamId:values[i][0],TeamName:values[i][1],Isb:stats?getPercentage(stats[0],sum):0,Ib:stats?getPercentage(stats[1],sum):0,Ob:stats?getPercentage(stats[2],sum):0});}return records;};}function TeamStageStats(config){var id,$view;init(config);function init(config){id=config.view.renderTo;$view=$("#"+id);}this.id=function(){return id;};this.load=function(data){var records=TeamStageStatsModel(data);$view.html(TeamStageStatsView(records));};}function TeamStageStatsView(records){var html=[];html.push('<table class="ws-list-grid with-three-cols">');html.push("<tr>");var listConfig={titles:["Summary"],view:{options:{displayFunction:function(stat){return stat.DisplayName+(stat.PerMatch?'<span class="sub-text">per game</span>':"");}}},statDisplayFunction:function(stat){if(undefined!=stat.Value2){return'<span style="white-space: nowrap;"><span class="yellow-card-box">'+stat.Value+"</span>"+'<span class="red-card-box">'+stat.Value2+"</span></span>";}return'<span class="stat-value number" style="font-weight: bold; float: right;">'+stat.Value+(stat.Percentage?"%":"")+"</span>";}};html.push('<td class="col">');html.push(new WS.List(listConfig).getHtml(records.Summary));html.push("</td>");html.push('<td class="col">');listConfig.titles=["Defensive"];html.push(new WS.List(listConfig).getHtml(records.Defensive));html.push("</td>");html.push('<td class="col">');listConfig.titles=["Offensive"];html.push(new WS.List(listConfig).getHtml(records.Offensive));html.push("</td>");html.push("</tr>");return html.join("");}function TeamStageStatsModel(data){var records={Summary:[],Offensive:[],Defensive:[]};var teamData=data.value[0];if(!teamData){return;}records.Summary.push({DisplayName:"Cards",Value:teamData.Yellow,Value2:teamData.Red});records.Summary.push({DisplayName:"Average Possession",Percentage:true,Value:NG.getAverage(teamData.Possession,teamData.GamesPlayed)});records.Summary.push({DisplayName:"Pass Success %",Percentage:true,Value:NG.getPercentage(teamData.AccuratePasses,teamData.TotalPasses)});records.Summary.push({DisplayName:"Aerial Duel won %",Percentage:true,Value:NG.getPercentage(teamData.AerialWon,(teamData.AerialWon+teamData.AerialLost))});records.Summary.push({DisplayName:"Average Rating",Value:teamData.Rating});records.Offensive.push({DisplayName:"Shots",PerMatch:true,Value:NG.getAverage(teamData.TotalShots,teamData.GamesPlayed)});records.Offensive.push({DisplayName:"Shots on target",PerMatch:true,Value:NG.getAverage(teamData.ShotsOnTarget,teamData.GamesPlayed)});records.Offensive.push({DisplayName:"Dribbles won",PerMatch:true,Value:NG.getAverage(teamData.Dribbles,teamData.GamesPlayed)});records.Offensive.push({DisplayName:"Fouls won",PerMatch:true,Value:NG.getAverage(teamData.WasFouled,teamData.GamesPlayed)});records.Offensive.push({DisplayName:"Offsides",PerMatch:true,Value:NG.getAverage(teamData.Offsides,teamData.GamesPlayed)});records.Defensive.push({DisplayName:"Shots conceded",PerMatch:true,Value:NG.getAverage(teamData.ShotsConcededIBox+teamData.ShotsConcededOBox,teamData.GamesPlayed)});records.Defensive.push({DisplayName:"Shots blocked",PerMatch:true,Value:NG.getAverage(teamData.ShotsBlocked,teamData.GamesPlayed)});records.Defensive.push({DisplayName:"Tackles",PerMatch:true,Value:NG.getAverage(teamData.TotalTackle,teamData.GamesPlayed)});records.Defensive.push({DisplayName:"Fouls",PerMatch:true,Value:NG.getAverage(teamData.WasFouled,teamData.GamesPlayed)});records.Defensive.push({DisplayName:"Interceptions",PerMatch:true,Value:NG.getAverage(teamData.Interceptions,teamData.GamesPlayed)});return records;}var TeamStageStatsGridDefaults=$.extend({},gridDefaults,{model:{type:TeamStageGoalsGridModel,cache:true},view:TeamStageTeamStatsGridView,sorter:{sortInfo:{property:"Value",direction:"desc"}}});function TeamStageCardsGridModel(){this.load=function(data){if(!data){return[];}var records=[];var cards=data.value[0];var stats=[0,0,0,0];AggresionModel(stats,cards);var sum=stats.sum();records.push({Type:"Fouls",Value:stats[0],Eff:getPercentage(stats[0],sum)});records.push({Type:"Unprofessional",Value:stats[1],Eff:getPercentage(stats[1],sum)});records.push({Type:"Dive",Value:stats[2],Eff:getPercentage(stats[2],sum)});records.push({Type:"Other",Value:stats[3],Eff:getPercentage(stats[3],sum)});return records;};}function TeamStagePassesGridModel(){this.load=function(data){if(!data){return[];}var records=[];var passes=data.value[1];var teamId=data.params.defaultParams.teamId;var teamsPlayed=DataStore.load("ws-stage-stat",{parameters:{stageId:data.params.defaultParams.stageId,type:25,teamId:teamId,field:2,against:0},cache:true,dataType:"array"});var field=parseInt(data.filter.data.field);var stats=[0,0,0,0];for(var j=0;j<passes.length;j++){PassTypesModel(stats,passes[j]);}var played=teamsPlayed[field];var sum=stats.sum();records.push({Type:"Cross",Value:Math.round(stats[0]/played),Eff:getPercentage(stats[0],sum)});records.push({Type:"Through ball",Value:Math.round(stats[1]/played),Eff:getPercentage(stats[1],sum)});records.push({Type:"Long ball",Value:Math.round(stats[2]/played),Eff:getPercentage(stats[2],sum)});records.push({Type:"Short pass",Value:Math.round(stats[3]/played),Eff:getPercentage(stats[3],sum)});return records;};}function TeamStageGoalsGridModel(){this.load=function(data){if(!data){return[];}var records=[];var attempts=data.value[0];var stats=[0,0,0,0,0];var contentFilter={goal:{index:0,value:"goal"}};for(var j=0;j<attempts.length;j++){GoalTypesModel(stats,attempts[j],contentFilter);}var sum=stats.sum();records.push({Type:"Open Play",Value:stats[0],Eff:getPercentage(stats[0],sum)});records.push({Type:"Set Piece",Value:stats[1],Eff:getPercentage(stats[1],sum)});records.push({Type:"Counter Attack",Value:stats[2],Eff:getPercentage(stats[2],sum)});records.push({Type:"Penalty",Value:stats[3],Eff:getPercentage(stats[3],sum)});records.push({Type:"Own Goal",Value:stats[4],Eff:getPercentage(stats[4],sum)});return records;};}function getMaxOfField(records,f){var max=0;for(var i=0;i<records.length;i++){if(max<records[i][f]){max=records[i][f];}}return max;}function TeamStageTeamStatsGridView(records){var t=[];var values=records.model.records;var statsMax=getMaxOfField(values,"Value");for(var i=0;i<values.length;i++){var o=values[i];t.push("<tr "+(1==i%2?'class="alt"':"")+">");t.push('<td class="type">'+o.Type+"</td>");t.push('<td class="value">');var width=(400/100)*getPercentage(o.Value,statsMax);t.push('<span class="stat-bar-wrapper" style="width: '+width+'px;">');t.push('<span class="stat-bar rc-r" style="width: 100%;">');t.push('<span class="stat-value '+(0==width?"zero":"")+'">'+o.Value+"</span>");t.push("</span>");t.push("</td>");t.push("<td>"+o.Eff+"%</td>");t.push("<tr>");}return t.join("");}var OverallTopTeamStatsSummaryGridDefaults=$.extend({},gridDefaults,{model:{type:TeamStatsSummaryGridModel,cache:true},view:TeamStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc",isGlobal:true}}});var OverallTopTeamStatsOffensiveGridDefaults=$.extend({},gridDefaults,{model:{type:TeamStatsOffensiveGridModel,cache:true},view:TeamStatsGridView,sorter:{sortInfo:{property:"Dribbles",direction:"desc"}}});var OverallTopTeamStatsDefensiveGridDefaults=$.extend({},gridDefaults,{model:{type:TeamStatsDefensiveGridModel,cache:true},view:TeamStatsGridView,sorter:{sortInfo:{property:"TotalTackle",direction:"desc"}}});function TeamStatsGridBaseModel(teamData){return{TeamId:teamData.TeamId,TeamName:teamData.TeamName,RegionCode:teamData.RegionCode,RegionId:teamData.RegionId,TournamentId:teamData.TournamentId,TournamentName:teamData.TournamentName,Ranking:teamData.Ranking,StatsAndHoverValues:{}};}function TeamStatsSummaryGridModel(){this.load=function(data){var teams=[];var values=data.value;if(!values||0==values.length){return teams;}for(var i=0;i<values.length;i++){var teamData=values[i];var team=TeamStatsGridBaseModel(teamData);team.StatsAndHoverValues={TotalShots:"Total Shots: {0}".format(teamData.TotalShots),Yellow:"",Red:"",CardPoints:"",Possession:"",PassSuccess:"Accurate/Total Passes: {0}/{1}".format(teamData.AccuratePasses,teamData.TotalPasses),AerialWon:"Won/Total Aerials: {0}/{1}".format(teamData.AerialWon,teamData.AerialWon+teamData.AerialLost),Rating:""};teams.push(jQuery.extend(true,team,{TotalShots:NG.getAverage(teamData.TotalShots,teamData.GamesPlayed,1),Yellow:teamData.Yellow,Red:teamData.Red,CardPoints:teamData.Yellow+(teamData.Red*3),Possession:NG.getAverage(teamData.Possession,teamData.GamesPlayed,1),PassSuccess:NG.percentage(teamData.AccuratePasses,teamData.TotalPasses,false,1),AerialWon:NG.getAverage(teamData.AerialWon,teamData.GamesPlayed,1),Rating:NG.roundNumber(teamData.Rating,2)}));}return teams;};}function TeamStatsOffensiveGridModel(){this.load=function(data){var teams=[];var values=data.value;if(!values||0==values.length){return teams;}for(var i=0;i<values.length;i++){var teamData=values[i];var team=TeamStatsGridBaseModel(teamData);team.StatsAndHoverValues={TotalShots:"Total Shots: {0}".format(teamData.TotalShots),ShotsOnTarget:"Total Shots on Target: {0}".format(teamData.ShotsOnTarget),Dribbles:"Total Successful Dribbles: {0}".format(teamData.Dribbles),WasFouled:"Total Fouled: {0}".format(teamData.WasFouled),Offsides:"Total Offsides: {0}".format(teamData.Offsides)};teams.push(jQuery.extend(true,team,{TotalShots:NG.getAverage(teamData.TotalShots,teamData.GamesPlayed,1),ShotsOnTarget:NG.getAverage(teamData.ShotsOnTarget,teamData.GamesPlayed,1),Dribbles:NG.getAverage(teamData.Dribbles,teamData.GamesPlayed,1),WasFouled:NG.getAverage(teamData.WasFouled,teamData.GamesPlayed,1),Offsides:NG.getAverage(teamData.Offsides,teamData.GamesPlayed,1)}));}return teams;};}function TeamStatsDefensiveGridModel(){this.load=function(data){var teams=[];var values=data.value;if(!values||0==values.length){return teams;}for(var i=0;i<values.length;i++){var teamData=values[i];var team=TeamStatsGridBaseModel(teamData);team.StatsAndHoverValues={ShotsConceded:"Total Shots Conceded: {0}".format(teamData.ShotsConcededIBox+teamData.ShotsConcededOBox),TotalTackle:"Total Tackles: {0}".format(teamData.TotalTackle),Interceptions:"Total Interceptions: {0}".format(teamData.Interceptions),Fouls:"Total Fouls: {0}".format(teamData.Fouls)};teams.push(jQuery.extend(true,team,{ShotsConceded:NG.getAverage(teamData.ShotsConcededIBox+teamData.ShotsConcededOBox,teamData.GamesPlayed,1),TotalTackle:NG.getAverage(teamData.TotalTackle,teamData.GamesPlayed,1),Interceptions:NG.getAverage(teamData.Interceptions,teamData.GamesPlayed,1),Fouls:NG.getAverage(teamData.Fouls,teamData.GamesPlayed,1)}));}teams.sort(function(a,b){return NG.sortNumeric(a.Rating,b.Rating);});return teams;};}function TeamStatsGridView(records){function getMaxStat(teams,maxes,f){if(maxes[f]){return maxes[f];}var max=0;for(var j=0;j<teams.length;j++){if(teams[i][f]){if(max<teams[j][f]){max=teams[j][f];}}}maxes[f]=max;return max;}var teams=records.model.records;var exclude={TeamId:1,TeamName:1,RegionId:1,RegionCode:1,TournamentId:1,TournamentName:1,WRating:1,Yellow:1,Red:1,Ranking:1};var useBar={Ads:1,Bp:1,Ps:1,Ds:1,Left:1,Centre:1,Right:1,Ib:1,Ob:1,Isb:1,Def:1,Mid:1,Att:1};var maxes={};var t=[];teams.sort(function(a,b){return NG.sortNumeric(a.Ranking,b.Ranking);});for(var i=0;i<teams.length;i++){var o=teams[i];t.push("<tr "+((1==i%2)?'class="alt"':"")+">");t.push('<td class="o">'+o.Ranking+"</td>");t.push('<td class="tn"><a href="/Teams/'+o.TeamId+'" class="team-link">'+o.TeamName+"</a></td>");t.push('<td class="tournament"><a href="/Regions/'+o.RegionId+"/Tournaments/"+o.TournamentId+'" class="tournament-link iconize iconize-icon-left">'+o.TournamentName+'<span class="ui-icon country flg-'+o.RegionCode+'"></span></a></td>');for(var f in o.StatsAndHoverValues){if(!exclude[f]){if("CardPoints"==f){t.push('<td class="agg">');t.push('<span class="yellow-card-box">'+o.Yellow+"</span>");t.push('<span class="red-card-box">'+o.Red+"</span>");t.push("</td>");}else{if(useBar[f]){var maxStat=getMaxStat(teams,maxes,f);t.push("<td>"+statBar(50,o[f],getPercentage(o[f],maxStat))+"</td>");}else{if("Rating"==f){t.push('<td><span class="stat-value rating">'+NG.roundNumber(o.Rating,2)+"</span></td>");}else{t.push('<td title="'+o.StatsAndHoverValues[f]+'" class="'+f.toLowerCase()+'">'+o[f]+"</td>");}}}}}t.push("</tr>");}return t.join("");}var TopPlayerStatsSummaryGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsSummaryGridModel,cache:true},view:TopPlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var TopPlayerStatsOffensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsOffensiveGridModel,cache:true},view:TopPlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var TopPlayerStatsDefensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsDefensiveGridModel,cache:true},view:TopPlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var TopPlayerStatsPassingGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsPassingGridModel,cache:true},view:TopPlayerStatsGridView,sorter:{sortInfo:{property:"Rating",direction:"desc"}}});var PlayerStatsSummaryGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsSummaryGridModel,cache:true},view:PlayerStatsGridView,sorter:{sortInfo:{property:"Apps",direction:"desc"}}});var PlayerStatsDefensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsDefensiveGridModel,cache:true},view:PlayerStatsGridView,sorter:{sortInfo:{property:"Apps",direction:"desc"}}});var PlayerStatsOffensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsOffensiveGridModel,cache:true},view:PlayerStatsGridView,sorter:{sortInfo:{property:"Apps",direction:"desc"}}});var PlayerStatsPassingGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerStatsPassingGridModel,cache:true},view:PlayerStatsGridView,sorter:{sortInfo:{property:"Apps",direction:"desc"}}});function PlayerStatsGridBaseModel(playerData){return{RegionId:playerData.RegionId,RegionCode:playerData.TeamRegionCode,TournamentId:playerData.TournamentId,TournamentName:playerData.TournamentName,StageId:playerData.StageId,IsOpta:playerData.IsOpta,TeamId:playerData.TeamId,TeamName:playerData.TeamName,Id:playerData.PlayerId,PlayerRegionCode:playerData.RegionCode,RealPosition:getRealPosition(playerData.PositionShort),PositionLong:playerData.PositionLong,PlayerName:playerData.Name,GameStarted:playerData.GameStarted,SubOn:playerData.SubOn,Apps:playerData.GameStarted+playerData.SubOn,Age:playerData.Age,Height:playerData.Height,Weight:playerData.Weight,IsCurrentPlayer:playerData.IsCurrentPlayer,WeightedRating:playerData.WeightedRating,Ranking:playerData.Ranking,StatsAndHoverValues:{}};}function PlayerStatsSummaryGridModel(){this.load=function(data){var players=[];var values=data.value;var isOptaTeam=false;if(!values||0==values.length){$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;}for(var i=0;i<values.length;i++){var playerData=values[i];var player=PlayerStatsGridBaseModel(playerData);var apps=(player.GameStarted+player.SubOn);if((0!=apps&&playerData.Rating)||isOptaTeam){player.StatsAndHoverValues={Goals:"",Assists:"",Yellow:"",Red:"",TotalShots:"Total Shots: {0}".format(playerData.TotalShots),PassSuccess:"Accurate/Total Passes: {0}/{1}".format(playerData.AccuratePasses,playerData.TotalPasses),AerialWon:"Won/Total Aerials: {0}/{1}".format(playerData.AerialWon,(playerData.AerialWon+playerData.AerialLost)),ManOfTheMatch:"",Rating:""};player.StatParams=[playerData.AccuratePasses,playerData.TotalPasses];jQuery.extend(true,player,{Goals:playerData.Goals,Assists:playerData.Assists,Yellow:playerData.Yellow,Red:playerData.Red,TotalShots:NG.getAverage(playerData.TotalShots,apps,1),PassSuccess:NG.percentage(playerData.AccuratePasses,playerData.TotalPasses,false,1),AerialWon:NG.getAverage(playerData.AerialWon,apps,1),ManOfTheMatch:playerData.ManOfTheMatch,Rating:NG.roundNumber(playerData.Rating,2)});isOptaTeam=true;}else{player.StatsAndHoverValues={Goals:"",Yellow:"",Red:""};player.Goals=playerData.Goals;player.Yellow=playerData.Yellow;player.Red=playerData.Red;}players.push(player);}$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;};}function PlayerStatsOffensiveGridModel(){this.load=function(data){var players=[];var values=data.value;var isOptaTeam=false;if(!values||0==values.length){$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;}for(var i=0;i<values.length;i++){var playerData=values[i];var player=PlayerStatsGridBaseModel(playerData);var apps=(player.GameStarted+player.SubOn);player.Goals=playerData.Goals;if((0!=apps&&playerData.Rating)||isOptaTeam){player.StatsAndHoverValues={Goals:"",Assists:"",TotalShots:"Total Shots: {0}".format(playerData.TotalShots),KeyPasses:"Total Key Passes: {0}".format(playerData.KeyPasses),Dribbles:"Total Successful Dribbles: {0}".format(playerData.Dribbles),WasFouled:"Total Fouled: {0}".format(playerData.WasFouled),Offsides:"Total Offsides: {0}".format(playerData.Offsides),Dispossesed:"Total Dispossessed: {0}".format(playerData.Dispossesed),Turnovers:"Total Turnovers: {0}".format(playerData.Turnovers),Rating:""};jQuery.extend(true,player,{Assists:playerData.Assists,TotalShots:NG.getAverage(playerData.TotalShots,apps,1),KeyPasses:NG.getAverage(playerData.KeyPasses,apps,1),Dribbles:NG.getAverage(playerData.Dribbles,apps,1),WasFouled:NG.getAverage(playerData.WasFouled,apps,1),Offsides:NG.getAverage(playerData.Offsides,apps,1),Dispossesed:NG.getAverage(playerData.Dispossesed,apps,1),Turnovers:NG.getAverage(playerData.Turnovers,apps,1),Rating:NG.roundNumber(playerData.Rating,2)});isOptaTeam=true;}players.push(player);}$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;};}function PlayerStatsPassingGridModel(){this.load=function(data){var players=[];var values=data.value;var isOptaTeam=false;if(!values||0==values.length){$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;}for(var i=0;i<values.length;i++){var playerData=values[i];var player=PlayerStatsGridBaseModel(playerData);var apps=(player.GameStarted+player.SubOn);if((0!=apps&&playerData.Rating)||isOptaTeam){player.StatsAndHoverValues={Assists:"",KeyPasses:"Total Key Passes: {0}".format(playerData.KeyPasses),TotalPasses:"Total Passes: {0}".format(playerData.TotalPasses),PassSuccess:"Accurate/Total Passes: {0}/{1}".format(playerData.AccuratePasses,playerData.TotalPasses),AccurateCrosses:"Accurate/Total Crosses: {0}/{1}".format(playerData.AccurateCrosses,playerData.TotalCrosses),AccurateLongBalls:"Accurate/Total Longballs: {0}/{1}".format(playerData.AccurateLongBalls,playerData.TotalLongBalls),AccurateThroughBalls:"Accurate/Total Throughballs: {0}/{1}".format(playerData.AccurateThroughBalls,playerData.TotalThroughBalls),Rating:""};player.StatParams=[playerData.AccuratePasses,playerData.TotalPasses];jQuery.extend(true,player,{Assists:playerData.Assists,KeyPasses:NG.getAverage(playerData.KeyPasses,apps,1),TotalPasses:NG.getAverage(playerData.TotalPasses,apps,1),PassSuccess:NG.percentage(playerData.AccuratePasses,playerData.TotalPasses,false,1),AccurateCrosses:NG.getAverage(playerData.AccurateCrosses,apps,1),AccurateLongBalls:NG.getAverage(playerData.AccurateLongBalls,apps,1),AccurateThroughBalls:NG.getAverage(playerData.AccurateThroughBalls,apps,1),Rating:NG.roundNumber(playerData.Rating,2)});isOptaTeam=true;}players.push(player);}$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;};}function PlayerStatsDefensiveGridModel(){this.load=function(data){var players=[];var values=data.value;var isOptaTeam=false;if(!values||0==values.length){$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;}for(var i=0;i<values.length;i++){var playerData=values[i];var player=PlayerStatsGridBaseModel(playerData);var apps=(player.GameStarted+player.SubOn);if((0!=apps&&playerData.Rating)||isOptaTeam){player.StatsAndHoverValues={TotalTackles:"Total Tackles: {0}".format(playerData.TotalTackles),Interceptions:"Total Interceptions: {0}".format(playerData.Interceptions),Fouls:"Total Fouls: {0}".format(playerData.Fouls),OffsidesWon:"Total Offsides Won: {0}".format(playerData.OffsidesWon),TotalClearances:"Total Clearances: {0}".format(playerData.TotalClearances),WasDribbled:"Total Dribbled by other players: {0}".format(playerData.WasDribbled),ShotsBlocked:"Total Shots Blocked: {0}".format(playerData.ShotsBlocked),OwnGoals:"",Rating:""};jQuery.extend(true,player,{TotalTackles:NG.getAverage(playerData.TotalTackles,apps,1),Interceptions:NG.getAverage(playerData.Interceptions,apps,1),Fouls:NG.getAverage(playerData.Fouls,apps,1),OffsidesWon:NG.getAverage(playerData.OffsidesWon,apps,1),TotalClearances:NG.getAverage(playerData.TotalClearances,apps,1),WasDribbled:NG.getAverage(playerData.WasDribbled,apps,1),ShotsBlocked:NG.getAverage(playerData.ShotsBlocked,apps,1),OwnGoals:playerData.OwnGoals,Rating:NG.roundNumber(playerData.Rating,2)});isOptaTeam=true;}players.push(player);}$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;};}function PlayerHistoryStatsGridBaseModel(playerData){return{RegionId:playerData.RegionId,RegionCode:playerData.TeamRegionCode,TournamentId:playerData.TournamentId,TournamentName:playerData.TournamentName,StageId:playerData.StageId,IsOpta:playerData.IsOpta,TeamId:playerData.TeamId,TeamName:playerData.TeamName,Id:playerData.PlayerId,PlayerRegionCode:playerData.RegionCode,RealPosition:getRealPosition(playerData.PositionShort),PositionLong:playerData.PositionLong,PlayerName:playerData.Name,GameStarted:playerData.GameStarted,SubOn:playerData.SubOn,Apps:playerData.GameStarted+playerData.SubOn,Age:playerData.Age,Height:playerData.Height,Weight:playerData.Weight,IsCurrentPlayer:playerData.IsCurrentPlayer,WeightedRating:playerData.WeightedRating,Ranking:playerData.Ranking,TournamentShortName:playerData.TournamentShortName,SeasonName:playerData.SeasonName,SeasonId:playerData.SeasonId,StatsAndHoverValues:{}};}var PlayerHistoricalStatsSummaryGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerHistoryStatsSummaryGridModel,cache:true},view:PlayerHistoryStatsGridView});var PlayerHistoricalStatsDefensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerHistoryStatsDefensiveGridModel,cache:true},view:PlayerHistoryStatsGridView});var PlayerHistoricalStatsOffensiveGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerHistoryStatsOffensiveGridModel,cache:true},view:PlayerHistoryStatsGridView});var PlayerHistoricalStatsPassingGridDefaults=$.extend({},gridDefaults,{model:{type:PlayerHistoryStatsPassingGridModel,cache:true},view:PlayerHistoryStatsGridView});function PlayerHistoryStatsSummaryGridModel(){this.load=function(data){var players=[];var values=data.value;var isOptaTeam=false;if(!values||0==values.length){$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;}for(var i=0;i<values.length;i++){var playerData=values[i];var player=PlayerHistoryStatsGridBaseModel(playerData);var apps=(player.GameStarted+player.SubOn);if((0!=apps&&playerData.Rating)||isOptaTeam){player.StatsAndHoverValues={Goals:"",Assists:"",Yellow:"",Red:"",TotalShots:"Total Shots: {0}".format(playerData.TotalShots),PassSuccess:"Accurate/Total Passes: {0}/{1}".format(playerData.AccuratePasses,playerData.TotalPasses),AerialWon:"Won/Total Aerials: {0}/{1}".format(playerData.AerialWon,(playerData.AerialWon+playerData.AerialLost)),ManOfTheMatch:"",Rating:""};player.StatParams=[playerData.AccuratePasses,playerData.TotalPasses];jQuery.extend(true,player,{Goals:playerData.Goals,Assists:playerData.Assists,Yellow:playerData.Yellow,Red:playerData.Red,TotalShots:NG.getAverage(playerData.TotalShots,apps,1),PassSuccess:NG.percentage(playerData.AccuratePasses,playerData.TotalPasses,false,1),AerialWon:NG.getAverage(playerData.AerialWon,apps,1),ManOfTheMatch:playerData.ManOfTheMatch,Rating:NG.roundNumber(playerData.Rating,2)});isOptaTeam=true;}else{player.StatsAndHoverValues={Goals:"",Yellow:"",Red:""};player.Goals=playerData.Goals;player.Yellow=playerData.Yellow;player.Red=playerData.Red;}players.push(player);}$(document).triggerHandler("player-tournament-stats-summary-updated",[isOptaTeam]);return players;};}function PlayerHistoryStatsOffensiveGridModel(){this.load=function(data){var players=[];var values=data.value;var isOptaTeam=false;if(!values||0==values.length){$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;}for(var i=0;i<values.length;i++){var playerData=values[i];var player=PlayerHistoryStatsGridBaseModel(playerData);var apps=(player.GameStarted+player.SubOn);player.Goals=playerData.Goals;if((0!=apps&&playerData.Rating)||isOptaTeam){player.StatsAndHoverValues={Goals:"",Assists:"",TotalShots:"Total Shots: {0}".format(playerData.TotalShots),KeyPasses:"Total Key Passes: {0}".format(playerData.KeyPasses),Dribbles:"Total Successful Dribbles: {0}".format(playerData.Dribbles),WasFouled:"Total Fouled: {0}".format(playerData.WasFouled),Offsides:"Total Offsides: {0}".format(playerData.Offsides),Dispossesed:"Total Dispossessed: {0}".format(playerData.Dispossesed),Turnovers:"Total Turnovers: {0}".format(playerData.Turnovers),Rating:""};jQuery.extend(true,player,{Assists:playerData.Assists,TotalShots:NG.getAverage(playerData.TotalShots,apps,1),KeyPasses:NG.getAverage(playerData.KeyPasses,apps,1),Dribbles:NG.getAverage(playerData.Dribbles,apps,1),WasFouled:NG.getAverage(playerData.WasFouled,apps,1),Offsides:NG.getAverage(playerData.Offsides,apps,1),Dispossesed:NG.getAverage(playerData.Dispossesed,apps,1),Turnovers:NG.getAverage(playerData.Turnovers,apps,1),Rating:NG.roundNumber(playerData.Rating,2)});isOptaTeam=true;}players.push(player);}$(document).triggerHandler("player-tournament-stats-offensive-updated",[isOptaTeam]);return players;};}function PlayerHistoryStatsPassingGridModel(){this.load=function(data){var players=[];var values=data.value;var isOptaTeam=false;if(!values||0==values.length){$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;}for(var i=0;i<values.length;i++){var playerData=values[i];var player=PlayerHistoryStatsGridBaseModel(playerData);var apps=(player.GameStarted+player.SubOn);if((0!=apps&&playerData.Rating)||isOptaTeam){player.StatsAndHoverValues={Assists:"",KeyPasses:"Total Key Passes: {0}".format(playerData.KeyPasses),TotalPasses:"Total Passes: {0}".format(playerData.TotalPasses),PassSuccess:"Accurate/Total Passes: {0}/{1}".format(playerData.AccuratePasses,playerData.TotalPasses),AccurateCrosses:"Accurate/Total Crosses: {0}/{1}".format(playerData.AccurateCrosses,playerData.TotalCrosses),AccurateLongBalls:"Accurate/Total Longballs: {0}/{1}".format(playerData.AccurateLongBalls,playerData.TotalLongBalls),AccurateThroughBalls:"Accurate/Total Throughballs: {0}/{1}".format(playerData.AccurateThroughBalls,playerData.TotalThroughBalls),Rating:""};player.StatParams=[playerData.AccuratePasses,playerData.TotalPasses];jQuery.extend(true,player,{Assists:playerData.Assists,KeyPasses:NG.getAverage(playerData.KeyPasses,apps,1),TotalPasses:NG.getAverage(playerData.TotalPasses,apps,1),PassSuccess:NG.percentage(playerData.AccuratePasses,playerData.TotalPasses,false,1),AccurateCrosses:NG.getAverage(playerData.AccurateCrosses,apps,1),AccurateLongBalls:NG.getAverage(playerData.AccurateLongBalls,apps,1),AccurateThroughBalls:NG.getAverage(playerData.AccurateThroughBalls,apps,1),Rating:NG.roundNumber(playerData.Rating,2)});isOptaTeam=true;}players.push(player);}$(document).triggerHandler("player-tournament-stats-passing-updated",[isOptaTeam]);return players;};}function PlayerHistoryStatsDefensiveGridModel(){this.load=function(data){var players=[];var values=data.value;var isOptaTeam=false;if(!values||0==values.length){$(document).triggerHandler("team-squad-stats-updated",[isOptaTeam]);return players;}for(var i=0;i<values.length;i++){var playerData=values[i];var player=PlayerHistoryStatsGridBaseModel(playerData);var apps=(player.GameStarted+player.SubOn);if((0!=apps&&playerData.Rating)||isOptaTeam){player.StatsAndHoverValues={TotalTackles:"Total Tackles: {0}".format(playerData.TotalTackles),Interceptions:"Total Interceptions: {0}".format(playerData.Interceptions),Fouls:"Total Fouls: {0}".format(playerData.Fouls),OffsidesWon:"Total Offsides Won: {0}".format(playerData.OffsidesWon),TotalClearances:"Total Clearances: {0}".format(playerData.TotalClearances),WasDribbled:"Total Dribbled by other players: {0}".format(playerData.WasDribbled),ShotsBlocked:"Total Shots Blocked: {0}".format(playerData.ShotsBlocked),OwnGoals:"",Rating:""};jQuery.extend(true,player,{TotalTackles:NG.getAverage(playerData.TotalTackles,apps,1),Interceptions:NG.getAverage(playerData.Interceptions,apps,1),Fouls:NG.getAverage(playerData.Fouls,apps,1),OffsidesWon:NG.getAverage(playerData.OffsidesWon,apps,1),TotalClearances:NG.getAverage(playerData.TotalClearances,apps,1),WasDribbled:NG.getAverage(playerData.WasDribbled,apps,1),ShotsBlocked:NG.getAverage(playerData.ShotsBlocked,apps,1),OwnGoals:playerData.OwnGoals,Rating:NG.roundNumber(playerData.Rating,2)});isOptaTeam=true;}players.push(player);}$(document).triggerHandler("player-tournament-stats-defensive-updated",[isOptaTeam]);return players;};}function TopPlayerStatsGridView(records){var t=[];var players=records.model.records;players.sort(function(a,b){return NG.sortNumeric(a.Ranking,b.Ranking);});for(var i=0;i<players.length;i++){var o=players[i];t.push("<tr "+((1==i%2)?'class="alt"':"")+">");t.push('<td class="o">'+o.Ranking+"</td>");t.push('<td class="rgn"><span class="ui-icon country flg-'+o.PlayerRegionCode+'"></span></td>');t.push('<td class="pn">'+WS.PlayerLink(o.Id,o.PlayerName)+"</td>");t.push('<td class="tn"><a href="/Teams/'+o.TeamId+'" class="team-link iconize iconize-icon-left"><span class="team-name">'+o.TeamName+'</span><span class="ui-icon country flg-'+o.RegionCode+'"></span></a></td>');t.push('<td class="pos" title="'+o.PositionLong+'">'+(o.RealPosition?o.RealPosition.substring(1,o.RealPosition.length):"-")+"</td>");t.push('<td class="ap" title="Total Appearances: '+o.Apps+'">'+"{0}{1}".format(o.GameStarted,0!=o.SubOn?"({0})".format(o.SubOn):"")+"</td>");for(var statName in o.StatsAndHoverValues){t.push('<td class="{0}" title="{2}">{1}</td>'.format(statName.toLowerCase(),o[statName],o.StatsAndHoverValues[statName]));}}return t.join("");}function TeamPlayerStatsGridView(records){var t=[];var players=records.model.records;for(var i=0;i<players.length;i++){var o=players[i];t.push('<tr class="'+((1==i%2)?"alt":"")+""+(!o.IsCurrentPlayer?" not-current-player":"")+'">');t.push('<td class="o">'+(i+1)+"</td>");t.push('<td class="rgn"><span class="ui-icon country flg-'+o.PlayerRegionCode+'"></span></td>');t.push('<td class="pn">'+WS.PlayerLink(o.Id,o.PlayerName)+"</td>");t.push('<td class="pos" title="'+o.PositionLong.replace("/",",")+'">'+(o.RealPosition?o.RealPosition.substring(1,o.RealPosition.length):"-")+"</td>");t.push('<td class="age">'+o.Age+"</td>");t.push('<td class="hg">'+o.Height+"</td>");t.push('<td class="wg">'+o.Weight+"</td>");t.push('<td class="ap" title="Total Appearances: '+o.Apps+'">'+"{0}{1}".format(o.GameStarted,0!=o.SubOn?"({0})".format(o.SubOn):"")+"</td>");for(var statName in o.StatsAndHoverValues){t.push('<td class="{0}" title="{2}">{1}</td>'.format(statName.toLowerCase(),o[statName],o.StatsAndHoverValues[statName]));}}return t.join("");}function H2HPlayerStatsGridView(records){var t=[];var players=records.model.records;for(var i=0;i<players.length;i++){var o=players[i];t.push("<tr "+((1==i%2)?'class="alt"':"")+">");t.push('<td class="o">'+(i+1)+"</td>");t.push('<td class="rgn"><span class="ui-icon country flg-'+o.PlayerRegionCode+'"></span></td>');t.push('<td class="pn">'+WS.PlayerLink(o.Id,o.PlayerName)+"</td>");t.push('<td class="tn"><a href="/Teams/'+o.TeamId+'" class="team-link iconize"><span class="team-name">'+o.TeamName+"</span></a></td>");t.push('<td class="pos" title="'+o.PositionLong+'">'+(o.RealPosition?o.RealPosition.substring(1,o.RealPosition.length):"-")+"</td>");t.push('<td class="hg">'+o.Height+"</td>");t.push('<td class="wg">'+o.Weight+"</td>");t.push('<td class="ap" title="Total Appearances: '+o.Apps+'">'+"{0}{1}".format(o.GameStarted,0!=o.SubOn?"({0})".format(o.SubOn):"")+"</td>");for(var statName in o.StatsAndHoverValues){t.push('<td class="{0}" title="{2}">{1}</td>'.format(statName.toLowerCase(),o[statName],o.StatsAndHoverValues[statName]));}}return t.join("");}function StagePlayerStatsGridView(records){var t=[];var players=records.model.records;for(var i=0;i<players.length;i++){var o=players[i];t.push("<tr "+((1==i%2)?'class="alt"':"")+">");t.push('<td class="o">'+o.Ranking+"</td>");t.push('<td class="rgn"><span class="ui-icon country flg-'+o.PlayerRegionCode+'"></span></td>');t.push('<td class="pn">'+WS.PlayerLink(o.Id,o.PlayerName)+"</td>");t.push('<td class="tn"><a href="/Teams/'+o.TeamId+'" class="team-link iconize"><span class="team-name">'+o.TeamName+"</span></a></td>");t.push('<td class="pos" title="'+o.PositionLong+'">'+(o.RealPosition?o.RealPosition.substring(1,o.RealPosition.length):"-")+"</td>");t.push('<td class="ap" title="Total Appearances: '+o.Apps+'">'+"{0}{1}".format(o.GameStarted,0!=o.SubOn?"({0})".format(o.SubOn):"")+"</td>");for(var statName in o.StatsAndHoverValues){t.push('<td class="{0}" title="{2}">{1}</td>'.format(statName.toLowerCase(),o[statName],o.StatsAndHoverValues[statName]));}}return t.join("");}function PlayerStatsGridView(records){var t=[];var tournaments=records.model.records;var maxNumberOfStats=0;var hasOpta=false;function setParams(){for(var i=0;i<tournaments.length;i++){var o=tournaments[i];var l=NG.JsonLength(o.StatsAndHoverValues);if(maxNumberOfStats<l){maxNumberOfStats=l;}if(o.IsOpta){hasOpta=true;}}}setParams();for(var i=0;i<tournaments.length;i++){var o=tournaments[i];t.push("<tr "+((1==i%2)?'class="alt"':"")+">");t.push('<td class="tournament">');t.push(WS.TournamentLink(o.RegionId,o.PlayerRegionCode,o.TournamentId,o.TournamentName));if(o.IsOpta){t.push("*");}if(!o.IsCurrentPlayer){t.push("({0})".format(WS.TeamLink(o.TeamId,getShortDisplayName(o.TeamName),"info")));}t.push("</td>");t.push('<td class="ap" title="Total Appearances: '+o.Apps+'">'+"{0}{1}".format(o.GameStarted,0!=o.SubOn?"({0})".format(o.SubOn):"")+"</td>");if(o.IsOpta){var statParamsStr=[];if(o.StatParams){for(var j=0;j<o.StatParams.length;j++){statParamsStr.push('data-{0}="{1}"'.format(j,o.StatParams[j]));}}for(var statName in o.StatsAndHoverValues){t.push('<td class="{0}" title="{2}" {3}>{1}</td>'.format(statName.toLowerCase(),o[statName],o.StatsAndHoverValues[statName],statParamsStr.join(" ")));}}else{if(o.Yellow){t.push('<td class="goals" title="">{0}</td>'.format(o.Goals));if(hasOpta){t.push('<td class="assists"><span class="not-available">N/A</span></td>');}t.push('<td class="yellow" title="Yellow Cards">{0}</td>'.format(o.Yellow));t.push('<td class="red" title="Red Cards">{0}</td>'.format(o.Red));if(0!=maxNumberOfStats){for(var j=0;j<(maxNumberOfStats-4);j++){t.push('<td><span class="not-available">N/A</span></td>');}}}else{var fillIns=maxNumberOfStats;if(o.Goals){t.push('<td class="goals" title="">{0}</td>'.format(o.Goals));fillIns--;}if(0!=fillIns){for(var j=0;j<(fillIns);j++){t.push('<td><span class="not-available">N/A</span></td>');}}}}}return t.join("");}function PlayerHistoryStatsGridView(records){var t=[];var tournaments=records.model.records;var maxNumberOfStats=0;var hasOpta=false;function setParams(){for(var i=0;i<tournaments.length;i++){var o=tournaments[i];var l=NG.JsonLength(o.StatsAndHoverValues);if(maxNumberOfStats<l){maxNumberOfStats=l;}if(o.IsOpta){hasOpta=true;}}}setParams();for(var i=0;i<tournaments.length;i++){var o=tournaments[i];t.push("<tr "+((1==i%2)?'class="alt"':"")+">");t.push('<td class="tournament">{0}</td>'.format(o.SeasonName));t.push('<td class="tournament">');t.push("{0}".format(WS.TeamLink(o.TeamId,getShortDisplayName(o.TeamName),"")));t.push("</td>");t.push('<td class="tournament">');t.push(WS.TournamentHistoryLink(o.RegionId,o.PlayerRegionCode,o.TournamentId,o.TournamentShortName,o.SeasonId,"",o.TournamentName+" ({0})".format(o.SeasonName)));t.push("</td>");t.push('<td class="ap" title="Total Appearances: '+o.Apps+'">'+"{0}{1}".format(o.GameStarted,0!=o.SubOn?"({0})".format(o.SubOn):"")+"</td>");if(o.IsOpta){var statParamsStr=[];if(o.StatParams){for(var j=0;j<o.StatParams.length;j++){statParamsStr.push('data-{0}="{1}"'.format(j,o.StatParams[j]));}}for(var statName in o.StatsAndHoverValues){t.push('<td class="{0}" title="{2}" {3}>{1}</td>'.format(statName.toLowerCase(),o[statName],o.StatsAndHoverValues[statName],statParamsStr.join(" ")));}}else{if(o.Yellow){t.push('<td class="goals" title="">{0}</td>'.format(o.Goals));if(hasOpta){t.push('<td class="assists"><span class="not-available">N/A</span></td>');}t.push('<td class="yellow" title="Yellow Cards">{0}</td>'.format(o.Yellow));t.push('<td class="red" title="Red Cards">{0}</td>'.format(o.Red));if(0!=maxNumberOfStats){for(var j=0;j<(maxNumberOfStats-4);j++){t.push('<td><span class="not-available">N/A</span></td>');}}}else{var fillIns=maxNumberOfStats;if(o.Goals){t.push('<td class="goals" title="">{0}</td>'.format(o.Goals));fillIns--;}if(0!=fillIns){for(var j=0;j<(fillIns);j++){t.push('<td><span class="not-available">N/A</span></td>');}}}}}return t.join("");}function LiveTopPerformingPlayersPresenter(config){var $view;init();function init(){$view=$(config.view.renderTo);}this.load=function(data){var model=new LiveTopPerformingPlayersModel(data);if(model){$view.html(LiveTopPerformingPlayersView(model));}};}function LiveTopPerformingPlayersModel(data){function getStatValue(stats,statDisplayName){if(!stats){return 0;}for(var i=0;i<stats.length;i++){if(statDisplayName==stats[i].DisplayName&&stats[i].Value!=undefined){return stats[i].Value;}}return 0;}if(!data){return;}if(2!=data.length){return;}var allPlayers=[];data[0][4].forEach(function(playerData){allPlayers.push(jQuery.extend({TeamId:data[0][0],TeamName:data[0][1]},new LivePlayerModel(playerData)));});data[1][4].forEach(function(playerData){allPlayers.push(jQuery.extend({TeamId:data[1][0],TeamName:data[1][1]},new LivePlayerModel(playerData)));});var results={Ratings:[],TotalShots:[],Tackles:[],Dribbles:[]};results.Ratings=allPlayers.where(function(a){return a.Rating&&0!=a.Rating;}).sort(function(a,b){if(a.IsManOfTheMatch>0){return -1;}if(b.IsManOfTheMatch>0){return 1;}return NG.sortNumeric(a.Rating,b.Rating)*(-1);}).slice(0,5);results.TotalShots=allPlayers.where(function(a){return 0!=getStatValue(a.Stats,"Total Shots");}).sort(function(a,b){var aValue=getStatValue(a.Stats,"Total Shots");var bValue=getStatValue(b.Stats,"Total Shots");a.TotalShots=aValue;b.TotalShots=bValue;return NG.sortNumeric(aValue,bValue)*(-1);}).slice(0,5);results.Tackles=allPlayers.where(function(a){return 0!=getStatValue(a.Stats,"Tackles");}).sort(function(a,b){var aValue=getStatValue(a.Stats,"Tackles");var bValue=getStatValue(b.Stats,"Tackles");a.Tackles=aValue;b.Tackles=bValue;return NG.sortNumeric(aValue,bValue)*(-1);}).slice(0,5);results.Dribbles=allPlayers.where(function(a){return 0!=getStatValue(a.Stats,"Dribbles Won");}).sort(function(a,b){var aValue=getStatValue(a.Stats,"Dribbles Won");var bValue=getStatValue(b.Stats,"Dribbles Won");a.Dribbles=aValue;b.Dribbles=bValue;return NG.sortNumeric(aValue,bValue)*(-1);}).slice(0,5);return results;}function LiveTopPerformingPlayersView(records){var t=[];if(!records){return t.join("");}var listConfig={view:{options:{displayFunction:function(player){return WS.TeamEmblemUrl(player.TeamId,player.TeamName)+'<span title="'+player.Name+'" class="player">'+WS.PlayerLink(player.Id,player.Name)+"</span>"+(1==player.SubstitutionType?'<span class="incidents-icon ui-icon subst-out"></span>':"")+'<span class="info"> ('+player.PositionText+")</span>"+(player.IsManOfTheMatch?'<span style="margin-left: 0.2em;" class="incident-wrapper"><span class="incidents-icon ui-icon mom" title="Man of the Match"></span></span>':"");}}}};var statDisplayFunctionTemplate=function(player,statValueType,clazz){if(undefined==player[statValueType]){return"";}return'<span class="stat-value number '+(clazz?clazz:"")+(1==player.SubstitutionType?" is-substituted":" is-inplay")+'">'+(statValueType=="Rating"?player[statValueType].toFixed(1):player[statValueType])+"</span>";};t.push('<table class="ws-list-grid with-two-cols">');t.push("<tbody>");t.push("<tr>");if(0!=records.Ratings.length){t.push('<td class="col">');t.push(new WS.List(jQuery.extend({},listConfig,{titles:["Rating","",""],statTypes:["Rating"],statDisplayFunction:function(player){return statDisplayFunctionTemplate(player,"Rating","rating");}})).getHtml(records.Ratings));t.push("</td>");}t.push("</tr>");t.push("<tr>");if(0!=records.TotalShots.length){t.push('<td class="col">');t.push(new WS.List(jQuery.extend({},listConfig,{titles:["Total Shots","",""],statTypes:["TotalShots"],statDisplayFunction:function(player){return statDisplayFunctionTemplate(player,"TotalShots");}})).getHtml(records.TotalShots));t.push("</td>");}t.push("</tr>");t.push("<tr>");if(0!=records.Tackles.length){t.push('<td class="col">');t.push(new WS.List(jQuery.extend({},listConfig,{titles:["Tackles","",""],statTypes:["Tackles"],statDisplayFunction:function(player){return statDisplayFunctionTemplate(player,"Tackles");}})).getHtml(records.Tackles));t.push("</td>");}t.push("</tr>");t.push("<tr>");if(0!=records.Dribbles.length){t.push('<td class="col">');t.push(new WS.List(jQuery.extend({},listConfig,{titles:["Dribbles","",""],statTypes:["Dribbles"],statDisplayFunction:function(player){return statDisplayFunctionTemplate(player,"Dribbles");}})).getHtml(records.Dribbles));t.push("</td>");}t.push("</tr>");t.push("</tbody>");t.push("</table>");return t.join("");}WS=WS||{};WS.Betting={};WS.Betting.ComparisionView={"clash":function(records,options){function findSumAndMaxOfValues(records){var max=0;var homeSum=0;var awaySum=0;for(var i=0;i<records.length;i++){if(max<records[i].home.Value){max=records[i].home.Value;}if(max<records[i].away.Value){max=records[i].away.Value;}homeSum+=records[i].home.Value;awaySum+=records[i].away.Value;}return{max:Math.max(max,1),homeSum:Math.max(homeSum,1),awaySum:Math.max(awaySum,1)};}var v=[];options=options||{};var sumAndMaxes=findSumAndMaxOfValues(records);var maxWidth=options.maxBarWidth?options.maxBarWidth:150;var labelWidth=options.labelWidth?options.labelWidth:50;var barWrapperWidth=(644-labelWidth)/2;v.push('<div class="betting-comparision-clash">');for(var i=0;i<records.length;i++){var homeLabel=(records[i].home.Display?records[i].home.Display:"");var awayLabel=(records[i].away.Display?records[i].away.Display:"");v.push('<div class="clash two-cols">');v.push('<span class="clash-bar-wrapper home" style="width: '+barWrapperWidth+'px">');v.push('<span class="clash-bar-label">');v.push('<span class="clash-value">'+records[i].home.Value+"</span>");if(homeLabel){v.push('<span class="clash-bar-label-text">'+homeLabel+"</span>");}v.push("</span>");v.push('<span class="clash-bar" style="width: '+Math.max(maxWidth*records[i].home.Value/sumAndMaxes.max,1)+'px">');v.push("</span>");v.push("</span>");if(options.splitLabels){v.push('<span class="two-cols" style="width: {0}px;">'.format(labelWidth));v.push('<span class="clash-label home">{0}</span>'.format(records[i].Display.home));v.push('<span class="clash-label away">{0}</span>'.format(records[i].Display.away));v.push("</span>");}else{v.push('<span class="clash-label" style="width: '+labelWidth+'px">'+records[i].Display+"</span>");}v.push('<span class="clash-bar-wrapper away" style="width: '+barWrapperWidth+'px">');v.push('<span class="clash-bar" style="width: '+Math.max(maxWidth*records[i].away.Value/sumAndMaxes.max,1)+'px">');v.push("</span>");v.push('<span class="clash-bar-label">');if(awayLabel){v.push('<span class="clash-bar-label-text">'+awayLabel+"</span>");}v.push('<span class="clash-value">'+records[i].away.Value+"</span>");v.push("</span>");v.push("</span>");v.push("</div>");}v.push("</div>");return v.join("");},"additive":function(categories,options){function findSumAndMaxOfValues(categories){var max=0;var homeSum=0;var awaySum=0;var homeMax=0;var awayMax=0;for(var i=0;i<categories.length;i++){for(var j=0;j<categories[i].Columns.length;j++){var c=categories[i].Columns[j];max=Math.max(max,c.home);max=Math.max(max,c.away);homeMax=Math.max(max,c.home);awayMax=Math.max(max,c.away);homeSum+=c.home;awaySum+=c.away;}}return{max:max,homeSum:homeSum,awaySum:awaySum,homeMax:homeMax,awayMax:awayMax};}var v=[];options=options||{};var maxAndSums=findSumAndMaxOfValues(categories);var maxBarHeight=60;var minBarHeight=20;v.push('<table class="betting-comparision-additive" style="width: 100%;">');v.push('<tr class="bar-row">');for(var i=0;i<categories.length;i++){v.push("<td>");for(var j=0;j<categories[i].Columns.length;j++){var c=categories[i].Columns[j];v.push('<ul class="additive-column">');if(0!=c.home){v.push('<li class="additive-column-bar home" style="height: '+(minBarHeight+(maxBarHeight*(c.home/maxAndSums.max)))+'px;"');v.push('title="'+c.home+" times ("+NG.roundNumber(100*c.home/maxAndSums.homeMax)+'%)"');v.push(">");v.push(c.home+" ("+NG.roundNumber(100*c.home/maxAndSums.homeMax)+"%)");v.push("</li>");}if(0!=c.away){v.push('<li class="additive-column-bar away" style="height: '+(minBarHeight+(maxBarHeight*(c.away/maxAndSums.max)))+'px;"');v.push('title="'+c.away+"times ("+NG.roundNumber(c.away/maxAndSums.awayMax)+'%)"');v.push(">");v.push(c.away+" ("+NG.roundNumber(100*c.away/maxAndSums.awayMax)+"%)");v.push("</li>");}v.push("</ul>");}v.push("</td>");}v.push("</tr>");v.push('<tr class="column-categories">');for(var i=0;i<categories.length;i++){v.push("<td>");for(var j=0;j<categories[i].Columns.length;j++){var c=categories[i].Columns[j];v.push('<ul class="additive-column">');v.push('<span class="additive-column-label">'+c.Display+"</span>");v.push("</ul>");}v.push("</td>");}v.push("</tr>");v.push('<tr class="categories">');for(var i=0;i<categories.length;i++){v.push("<td>");v.push('<span class="additive-category-label">'+categories[i].Display+"</span>");v.push("</td>");}v.push("</tr>");v.push("</table>");return v.join("");}};WS.Betting.ComparisionModel={"fulltime":function(homeRecords,awayRecords){var rows=[];rows.push({Display:"1",home:{Display:'<span class="l-win rc">Win</span>',Value:homeRecords.Win},away:{Display:'<span class="l-lose rc">Lose</span>',Value:awayRecords.Lose},probability:homeRecords.Win+awayRecords.Lose});rows.push({Display:"x",home:{Display:'<span class="l-draw rc">Draw</span>',Value:homeRecords.Draw},away:{Display:'<span class="l-draw rc">Draw</span>',Value:awayRecords.Draw},probability:homeRecords.Draw+awayRecords.Draw});rows.push({Display:"2",home:{Display:'<span class="l-lose rc">Lose</span>',Value:homeRecords.Lose},away:{Display:'<span class="l-win rc">Win</span>',Value:awayRecords.Win},probability:homeRecords.Lose+awayRecords.Win});return rows;},"htft":function(homeRecords,awayRecords){var rows=[];rows.push({Display:"1/1",home:{Display:'<span class="l-win rc">Win</span> and <span class="l-win rc">Win</span>',Value:homeRecords.WinWin},away:{Display:'<span class="l-lose rc">Lose</span> and <span class="l-lose rc">Lose</span>',Value:awayRecords.LoseLose},probability:homeRecords.WinWin+awayRecords.LoseLose});rows.push({Display:"1/X",home:{Display:'<span class="l-win rc">Win</span> and <span class="l-draw rc">Draw</span>',Value:homeRecords.WinDraw},away:{Display:'<span class="l-lose rc">Lose</span> and <span class="l-draw rc">Draw</span>',Value:awayRecords.LoseDraw},probability:homeRecords.WinDraw+awayRecords.LoseDraw});rows.push({Display:"1/2",home:{Display:'<span class="l-win rc">Win</span> and <span class="l-lose rc">Lose</span>',Value:homeRecords.WinLose},away:{Display:'<span class="l-lose rc">Lose</span> and <span class="l-win rc">Win</span>',Value:awayRecords.LoseWin},probability:homeRecords.WinLose+awayRecords.LoseWin});rows.push({Display:"X/1",home:{Display:'<span class="l-draw rc">Draw</span> and <span class="l-win rc">Win</span>',Value:homeRecords.DrawWin},away:{Display:'<span class="l-draw rc">Draw</span> and <span class="l-lose rc">Lose</span>',Value:awayRecords.DrawLose},probability:homeRecords.DrawWin+awayRecords.DrawLose});rows.push({Display:"X/X",home:{Display:'<span class="l-draw rc">Draw</span> and <span class="l-draw rc">Draw</span>',Value:homeRecords.DrawDraw},away:{Display:'<span class="l-draw rc">Draw</span> and <span class="l-draw rc">Draw</span>',Value:awayRecords.DrawDraw},probability:homeRecords.DrawDraw+awayRecords.DrawDraw});rows.push({Display:"X/2",home:{Display:'<span class="l-draw rc">Draw</span> and <span class="l-lose rc">Lose</span>',Value:homeRecords.DrawLose},away:{Display:'<span class="l-draw rc">Draw</span> and <span class="l-win rc">Win</span>',Value:awayRecords.DrawWin},probability:homeRecords.DrawLose+awayRecords.DrawWin});rows.push({Display:"2/1",home:{Display:'<span class="l-lose rc">Lose</span> and <span class="l-win rc">Win</span>',Value:homeRecords.LoseWin},away:{Display:'<span class="l-win rc">Win</span> and <span class="l-lose rc">Lose</span>',Value:awayRecords.WinLose},probability:homeRecords.LoseWin+awayRecords.WinLose});rows.push({Display:"2/X",home:{Display:'<span class="l-lose rc">Lose</span> and <span class="l-draw rc">Draw</span>',Value:homeRecords.LoseDraw},away:{Display:'<span class="l-win rc">Win</span> and <span class="l-draw rc">Draw</span>',Value:awayRecords.WinDraw},probability:homeRecords.LoseDraw+awayRecords.WinDraw});rows.push({Display:"2/2",home:{Display:'<span class="l-lose rc">Lose</span> and <span class="l-lose rc">Lose</span>',Value:homeRecords.LoseLose},away:{Display:'<span class="l-win rc">Win</span> and <span class="l-win rc">Win</span>',Value:awayRecords.WinWin},probability:homeRecords.LoseLose+awayRecords.WinWin});return rows;},"doublechance":function(homeRecords,awayRecords){var rows=[];rows.push({Display:"1/X",home:{Display:'<span class="l-win rc">Win</span> or <span class="l-draw rc">Draw</span>',Value:homeRecords.WinOrDraw},away:{Display:'<span class="l-lose rc">Lose</span> or <span class="l-draw rc">Draw</span>',Value:awayRecords.DrawOrLose},probability:homeRecords.WinOrDraw+awayRecords.DrawOrLose});rows.push({Display:"1/2",home:{Display:'<span class="l-win rc">Win</span> or <span class="l-lose rc">Lose</span>',Value:homeRecords.WinOrLose},away:{Display:'<span class="l-win rc">Win</span> or <span class="l-lose rc">Lose</span>',Value:awayRecords.WinOrLose},probability:homeRecords.WinOrLose+awayRecords.WinOrLose});rows.push({Display:"2/X",home:{Display:'<span class="l-lose rc">Lose</span> or <span class="l-draw rc">Draw</span>',Value:homeRecords.DrawOrLose},away:{Display:'<span class="l-win rc">Win</span> or <span class="l-draw rc">Draw</span>',Value:awayRecords.WinOrDraw},probability:homeRecords.DrawOrLose+awayRecords.WinOrDraw});return rows;},"overunder":function(homeRecords,awayRecords){var categories=[];var max=5;for(var i=0;i<max;i++){categories.push({Display:i+".5",Columns:[{Display:"Under",home:homeRecords["Under_"+i+"_5"],away:awayRecords["Under_"+i+"_5"]},{Display:"Over",home:homeRecords["Over_"+i+"_5"],away:awayRecords["Over_"+i+"_5"]}]});}return categories;},"correctscore":function(homeRecords,awayRecords){function findScored(records,scored){var sum=0;for(var i=0;i<records.length;i++){if(records[i].s==scored){sum+=records[i].o;}}return sum;}var maxGoals=4;var rows=[];for(var i=0;i<maxGoals;i++){for(var j=0;j<maxGoals;j++){var h=findScored(homeRecords,i);var a=findScored(awayRecords,j);rows.push({Display:{home:i,away:j},home:{Value:h},away:{Value:a},probability:a+h});}}return rows;},"goaltimes":function(homeRecords,awayRecords){var rows=[];var interval=homeRecords.interval;var intervalScale=homeRecords.intervalScale;for(var i=0;i<=90/interval;i+=intervalScale){var h=0;var a=0;for(var j=i;j<i+intervalScale;j++){if(homeRecords.values[j]){h+=homeRecords.values[j];}if(awayRecords.values[j]){a+=awayRecords.values[j];}}if(h!=0||a!=0){var label=90<((i+intervalScale)*interval)?"90+":i*interval+" - "+((i+intervalScale)*interval);rows.push({Display:label,home:{Value:h},away:{Value:a},probability:a+h});}}return rows;},"csfs":function(homeRecords,awayRecords){var rows=[];rows.push({Display:"Home cs",home:{Display:"clean sheet",Value:homeRecords.cs},away:{Display:"failed to score",Value:awayRecords.fs},probability:awayRecords.fs+homeRecords.cs});rows.push({Display:"Away cs",home:{Display:"failed to score",Value:homeRecords.fs},away:{Display:"clean sheet",Value:awayRecords.cs},probability:awayRecords.cs+homeRecords.fs});return rows;}};WS.Betting.Model={"fulltime":function(data){if(!data){return null;}return{Win:data[0],Draw:data[1],Lose:data[2]};},"htft":function(data,contentFilter){if(!data){return null;}var o={};data=data[0][contentFilter.period][1];for(var i=0;i<data.length;i++){var r=data[i];o[r[0]]=r[1];}return o;},"doublechance":function(data){if(!data){return null;}return{WinOrDraw:data[0]+data[1],WinOrLose:data[0]+data[2],DrawOrLose:data[1]+data[2]};},"overunder":function(data,contentFilter){if(!data){return null;}var o={};data=data[0][contentFilter.period][1];for(var i=0;i<data.length;i++){var r=data[i];o["Over"+r[0]]=r[1];o["Under"+r[0]]=r[2];}return o;},"correctscore":function(data,contentFilter){if(!data){return null;}var o=[];data=data[0][contentFilter.period][1];for(var i=0;i<data.length;i++){var r=data[i];o.push({s:r[0],c:r[1],o:r[2][0]});}return o;},"goaltimes":function(data,contentFilter){if(!data){return null;}var intervalScale=contentFilter.intervalScale?NG.roundNumber(contentFilter.intervalScale):2;var o={intervalScale:intervalScale,interval:5,values:{},against:contentFilter.against};data=data[0][contentFilter.period][1];for(var i=0;i<data.length;i++){o.values[data[i][0]]=data[i][1];}return o;},"csfs":function(data,contentFilter){if(!data){return null;}data=data[0][contentFilter.period][1];return{cs:data[0][0],fs:data[0][1]};}};WS.Betting.Comparision=function(config){var id,dataType,viewType,options,$view,records,dataModel,comparisionModel,orderByProbability,currentData,self=this;init(config);this.load=function(data){currentData=data;var homeRecords=new dataModel(data.home.value,data.home.contentFilter);var awayRecords=new dataModel(data.away.value,data.away.contentFilter);var comparisionRecords=new comparisionModel(homeRecords,awayRecords);if(orderByProbability){comparisionRecords.sort(function(a,b){return NG.sortNumeric(a.probability,b.probability)*(-1);});}var html=WS.Betting.ComparisionView[viewType](comparisionRecords,options.view);$view.html(html);};this.id=function(){return id;};function bindEvents(){$(document).bind("betting-stats-order-changed",function(options,data){orderByProbability=data;self.load(currentData);});}function init(config){if(!config.id){return;}id=config.id;$view=$("#"+id);options=config.options||{};dataType=config.model.type.toLowerCase();dataModel=WS.Betting.Model[dataType];comparisionModel=WS.Betting.ComparisionModel[dataType];viewType=config.view.type.toLowerCase();orderByProbability=options.orderByProbability||false;bindEvents();}};